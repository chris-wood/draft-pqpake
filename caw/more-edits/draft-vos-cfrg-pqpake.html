<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Hybrid Post-Quantum Password Authenticated Key Exchange</title>
<meta content="Jelle Vos" name="author">
<meta content="Stanislaw Jarecki" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="
       This document describes the CPaceOQUAKE+ protocol, a hybrid asymmetric
password-authenticated key exchange (aPAKE) that supports mutual
authentication in a client-server setting secure against
quantum-capable attackers. CPaceOQUAKE+ is the result of a KEM-based transformation from the hybrid symmetric PAKE protocol called CPaceOQUAKE that is also described in this document. This document recommends configurations for
CPaceOQUAKE+ and corresponding test vectors. 
    " name="description">
<meta content="xml2rfc 3.28.0" name="generator">
<meta content="draft-vos-cfrg-pqpake-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.28.0
    Python 3.12.9
    ConfigArgParse 1.7
    google-i18n-address 3.1.1
    intervaltree 3.1.0
    Jinja2 3.1.5
    lxml 5.3.0
    platformdirs 4.3.6
    pycountry 24.6.1
    PyYAML 6.0.2
    requests 2.32.3
    setuptools 70.3.0
    wcwidth 0.2.13
-->
<link href="draft-vos-cfrg-pqpake.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}

@font-face {
  font-family: 'Lora';
  font-style: italic;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Italic'), local('Lora-Italic'), url('https://martinthomson.github.io/rfc-css/fonts/lora-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Lora Regular'), local('Lora-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/lora-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-cyrillic.woff2') format('woff2');
  unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-vietnamese.woff2') format('woff2');
  unicode-range: U+0102-0103, U+0110-0111, U+1EA0-1EF9, U+20AB;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 700;
  font-display: swap;
  src: local('Lora Bold'), local('Lora-Bold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-bold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Lora';
  font-style: normal;
  font-weight: 600;
  font-display: swap;
  src: local('Lora SemiBold'), local('Lora-SemiBold'), url('https://martinthomson.github.io/rfc-css/fonts/lora-semibold-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Oxygen Mono';
  font-style: normal;
  font-weight: 400;
  font-display: swap;
  src: local('Oxygen Mono'), local('OxygenMono-Regular'), url('https://martinthomson.github.io/rfc-css/fonts/oxygenmono-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: italic;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-italic-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic-ext.woff2') format('woff2');
  unicode-range: U+0460-052F, U+1C80-1C8A, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-cyrillic.woff2') format('woff2');
  unicode-range: U+0301, U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-greek.woff2') format('woff2');
  unicode-range: U+0370-0377, U+037A-037F, U+0384-038A, U+038C, U+038E-03A1, U+03A3-03FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin-ext.woff2') format('woff2');
  unicode-range: U+0100-02BA, U+02BD-02C5, U+02C7-02CC, U+02CE-02D7, U+02DD-02FF, U+0304, U+0308, U+0329, U+1D00-1DBF, U+1E00-1E9F, U+1EF2-1EFF, U+2020, U+20A0-20AB, U+20AD-20C0, U+2113, U+2C60-2C7F, U+A720-A7FF;
}
@font-face {
  font-family: 'Sofia Sans Semi Condensed';
  font-style: normal;
  font-weight: 1 1000;
  src: url('https://martinthomson.github.io/rfc-css/fonts/sofiasanssemicondensed-regular-latin.woff2') format('woff2');
  unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+0304, U+0308, U+0329, U+2000-206F, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
}

:root {
  color-scheme: light dark;
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --pilcrow-weak: #ddd;
  --pilcrow-strong: #bbb;
  --small-font-size: 14.5px;
  --font-mono: 'Oxygen Mono', monospace;
  --font-title: "Sofia Sans Semi Condensed", sans-serif;
  scrollbar-color: #bbb #eee;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
section {
  clear: both;
}
.section-number {
  padding-right: 0.5em;
}
h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-title);
  font-weight: 680;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
h1#title {
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1#title, h1#rfcnum {
  margin: 1.5em 0 0.2em;
}
h1#rfcnum + h1#title {
  margin: 0.2em 0;
}

h1, h2, h3 {
  font-size: 22px;
  line-height: 27px;
}
h4, h5, h6 {
  font-size: 20px;
  line-height: 24px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
  vertical-align: top;
}
#abstract+p {
  font-size: 18px;
  line-height: 24px;
}
#abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 16px;
  line-height: 0;
}

p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
/* font-family isn't space-separated, but =~ will have to do */
svg[font-family~="monospace" i], svg [font-family~="monospace" i] {
  font-family: var(--font-mono);
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 0.5em 2em;
  & :is(ol, ul) {
    margin-left: 1em;
  }
}
li {
  margin: 0 0 0.25em 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
  & li {
    margin-top: 0.5em;
  }
}
:is(ul, ol).compact, .ulCompact, .olCompact {
  margin: 0 0 0 2em;
  & li {
    margin: 0;
    & :first-child { margin-top: 0; }
    & :last-child { margin-bottom: 0; }
  }
}

/* definition lists */
dl {
  clear: left;
  --indent: 3ch;
  /* --indent: attr(indent ch); not supported in any browser, but we can dream */
  &.olPercent {
    --indent: 5ch;
    & > dt {
      min-width: calc(var(--indent) - 2ch);
    }
  }
  &.olPercent > dt {
    float: none;
  }

  dl > dd > & {
    margin-top: 0.5em;
    margin-bottom: 0;
  }
}
dl:not(.dlNewline) > dt {
  float: left;
  margin-right: 2ch;
  min-width: 8ch;
}
dl > dd {
  margin-bottom: .8em;
  margin-left: var(--indent) !important; /* stupid element overrides */
  min-height: 2ex;
}
:is(dl.compact, .dlCompact) > dd {
  margin-bottom: 0;
  & > :is(:first-child, .break:first-child + *) {
    margin-top: 0;
  }
  & > :is(:last-child) {
    margin-bottom: 0;
  }
}
:is(dd, span).break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href] {
  color: var(--link-color);
}
a[href].selfRef, .iref + a[href].internal {
  color: var(--text-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref:is(.cite, .auto), :is(#status-of-memo, #copyright) a {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px var(--font-mono);
}
tt, code {
  /* changing the font for inline elements leads to different ascender
     and descender heights; as we want to retain baseline alignment,
     remove leading to avoid altering the final height of lines
     note: this fails if these blocks take an entire line,
     a different solution would be great */
  line-height: 0;
}
:is(h1, h2, h3, h4, h5, h6) :is(tt, code) {
  font-size: 84%;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
  padding: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
  caption-side: bottom;
}
@media screen {
  /* Auto-collapse boilerplate. */
  :is(#status-of-memo, #copyright) p {
    margin: -2px 0;
    max-height: 0;
    transition: max-height 2s ease, margin 0.5s ease 0.5s;
    overflow: hidden;
  }
  :is(#status-of-memo, #copyright):hover p,
  :is(#status-of-memo, #copyright) h2:target ~ p {
    margin: 0.5em 0;
    max-height: 500px;
    overflow: auto;
  }
  pre, svg {
    display: inline-block;
    /* In the horizontal direction, sometimes people make over-sized figures.
       Scrollbars for those is therefore necessary: auto adds them as necessary..
       In the vertical direction, the line-height can combine with the font
       asender/descender height to produce scrollbars: hidden avoids that. */
    overflow: auto hidden;
  }
  pre {
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  svg {
    max-width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  :is(pre, svg) + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: auto;
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
table .text-left {
  text-align: left;
}
table .text-center {
  text-align: center;
}
table .text-right {
  text-align: right;
}

thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
:is(tr:nth-child(2n), thead+tbody > tr:nth-child(2n+1)) > td {
  background-color: var(--background-color);
}
:is(tr:nth-child(2n+1), thead+tbody > tr:nth-child(2n)) > td {
  background-color: var(--highlight-color);
}
table caption {
  margin: 0;
  padding: 3px 0 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  opacity: 0.2;
  user-select: none;
  &[href] {
    color: var(--pilcrow-weak);
    &:hover { text-decoration: none; }
  }
}
@media not print {
  :hover > a.pilcrow {
    opacity: 1;
  }
  a.pilcrow[href]:hover {
    color: var(--pilcrow-strong);
    background-color: transparent;
  }
}
@media print {
  a.pilcrow {
    display: none;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
  font-weight: 600;
  font-size: var(--small-font-size);
}
.role {
  font-variant: all-small-caps;
}
sub, sup {
  line-height: 1;
  font-size: 80%;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 15ch;
  & dt {
    width: var(--identifier-width);
    min-width: var(--identifier-width);
    clear: left;
    float: left;
    text-align: right;
    margin-right: 1ch;
  }
  & dd {
    margin: 0;
    margin-left: calc(1em + var(--identifier-width)) !important;
    min-width: 5em;
  }
  & .authors {
    & .author {
      display: inline-block;
      margin-right: 1.5em;
    }
    & .org {
      font-style: italic;
    }
  }
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;

  & nav {
    & ul {
      margin: 0 0.5em 0 0;
      padding: 0;
      list-style: none;
    }
    & li {
      line-height: 1.3em;
      margin: 2px 0;
      padding-left: 1.2em;
      text-indent: -1.2em;
    }
  }
  & a.xref {
    white-space: normal;
  }
}

.references {
  & > dt {
    text-align: right;
    font-weight: bold;
    min-width: 10ch;
    margin-right: 1.5ch;
    &:target::before {
      content: "⇒";
      margin: 0 10px 0 -25px;
    }
  }
  & > dd {
    margin-left: 12ch !important;
    overflow: visible;
    & .refInstance {
      margin-bottom: 0.8em;
    }
    & .ascii {
      margin-bottom: 0.25em;
    }
  }
}

#rfc\.index\.index + ul {
  margin-left: 0;
}

/* authors */
address.vcard {
  font-style: normal;
  max-width: 20em;
  margin: 1em auto 1em 0;

  & .nameRole {
    font-weight: 700;
    margin-left: 0;
  }
  & .label {
    margin: 0.5em 0;
  }
  & .type {
    display: none;
  }
  & .alternative-contact {
    margin: 0.5em 0 0.25em 0;
  }
  & .non-ascii {
    margin: 0 0 0 2em;
  }
  & div.left {
    text-align: left;
  }
  & div.right {
    text-align: right;
  }
}

hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

/* Comments */
.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}

@media screen {
  #toc nav {
    font-family: var(--font-title);
    font-weight: 360;
    & > ul { margin-bottom: 2em; }
    & ul {
      margin: 0 0 0 4px;
      & :is(p, li) {
        margin: 2px 0;
      }
    }
  }
  #toc a.toplink {
    float: right;
  }
}
@media not screen {
  #toc a.toplink {
    display: none;
  }
}


/* TOC layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 1px 0 0 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
    &::before { /* css hamburger */
      float: right;
      position: relative;
      width: 1em;
      height: 1px;
      left: -164px;
      margin: 8px 0 0 0;
      background: white none repeat scroll 0 0;
      box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
      content: "";
    }
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active {
    opacity: 1;
    & nav { display: block; }
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:is(:link, :focus, :hover),
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin: 2px 0.5em 0;
  }
}

/* TOC layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
  #toc a.toplink {
    margin: 8px 0.5em 0;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre, .vcard {
    page-break-inside: avoid;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  :is(h2, h3, h4, h5, h6)+*, dd {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Dark mode. */
@media (prefers-color-scheme: dark) {
:root {
  --background-color: #121212;
  --text-color: #f0f0f0;
  --title-color: #fff;
  --link-color: #4da4f0;
  --highlight-color: #282828;
  --line-color: #444;
  --pilcrow-weak: #444;
  --pilcrow-strong: #666;
  scrollbar-color: #777 #333;
}
}

/* SVG Trick: a prefix match works because only black and white are allowed */
svg :is([stroke="black"], [stroke^="#000"]) {
  stroke: var(--text-color);
}
svg :is([stroke="white"], [stroke^="#fff"]) {
  stroke: var(--background-color);
}
svg :is([fill="black"], [fill^="#000"], :not([fill])) {
  fill: var(--text-color);
}
svg :is([fill="white"], [fill^="#fff"]) {
  fill: var(--background-color);
}
</style>

</head>
<body class="xml2rfc">
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">Hybrid PQ-PAKE</td>
<td class="right">March 2025</td>
</tr></thead>
<tfoot><tr>
<td class="left">Vos, et al.</td>
<td class="center">Expires 18 September 2025</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-vos-cfrg-pqpake-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2025-03-17" class="published">17 March 2025</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Informational</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2025-09-18">18 September 2025</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">J. Vos</div>
</div>
<div class="author">
      <div class="author-name">S. Jarecki</div>
<div class="org">University of California, Irvine</div>
</div>
<div class="author">
      <div class="author-name">C. A. Wood</div>
<div class="org">Apple, Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Hybrid Post-Quantum Password Authenticated Key Exchange</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document describes the CPaceOQUAKE+ protocol, a hybrid asymmetric
password-authenticated key exchange (aPAKE) that supports mutual
authentication in a client-server setting secure against
quantum-capable attackers. CPaceOQUAKE+ is the result of a KEM-based transformation from the hybrid symmetric PAKE protocol called CPaceOQUAKE that is also described in this document. This document recommends configurations for
CPaceOQUAKE+ and corresponding test vectors.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<section class="note rfcEditorRemove" id="section-note.1">
      <h2 id="name-about-this-document">
<a href="#name-about-this-document" class="section-name selfRef">About This Document</a>
      </h2>
<p id="section-note.1-1">This note is to be removed before publishing as an RFC.<a href="#section-note.1-1" class="pilcrow">¶</a></p>
<p id="section-note.1-2">
        The latest revision of this draft can be found at <span><a href="https://example.com/LATEST">https://example.com/LATEST</a></span>.
        Status information for this document may be found at <span><a href="https://datatracker.ietf.org/doc/draft-vos-cfrg-pqpake/">https://datatracker.ietf.org/doc/draft-vos-cfrg-pqpake/</a></span>.<a href="#section-note.1-2" class="pilcrow">¶</a></p>
<p id="section-note.1-3">
        Discussion of this document takes place on the
        CFRG Crypto Forum Research Group mailing list (<span><a href="mailto:WG@example.com">mailto:WG@example.com</a></span>),
        which is archived at <span><a href="https://example.com/WG">https://example.com/WG</a></span>.<a href="#section-note.1-3" class="pilcrow">¶</a></p>
<p id="section-note.1-4">Source for this draft and an issue tracker can be found at
        <span><a href="https://github.com/USER/REPO">https://github.com/USER/REPO</a></span>.<a href="#section-note.1-4" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 18 September 2025.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2025 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="auto internal xref">1</a>.  <a href="#name-introduction" class="internal xref">Introduction</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="auto internal xref">2</a>.  <a href="#name-conventions-and-definitions" class="internal xref">Conventions and Definitions</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="auto internal xref">2.1</a>.  <a href="#name-notation-and-terminology" class="internal xref">Notation and Terminology</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="auto internal xref">3</a>.  <a href="#name-overview" class="internal xref">Overview</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="auto internal xref">4</a>.  <a href="#name-cryptographic-dependencies" class="internal xref">Cryptographic Dependencies</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="auto internal xref">4.1</a>.  <a href="#name-key-encapsulation-mechanism" class="internal xref">Key Encapsulation Mechanism</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="auto internal xref">4.2</a>.  <a href="#name-binary-uniform-kem" class="internal xref">Binary Uniform KEM</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="auto internal xref">4.3</a>.  <a href="#name-key-derivation-function" class="internal xref">Key Derivation Function</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.4">
                <p id="section-toc.1-1.4.2.4.1"><a href="#section-4.4" class="auto internal xref">4.4</a>.  <a href="#name-key-stretching-function" class="internal xref">Key Stretching Function</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="auto internal xref">5</a>.  <a href="#name-cpaceoquake-protocol" class="internal xref">CPaceOQUAKE Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="auto internal xref">5.1</a>.  <a href="#name-cpace-specification" class="internal xref">CPace Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.1">
                    <p id="section-toc.1-1.5.2.1.2.1.1"><a href="#section-5.1.1" class="auto internal xref">5.1.1</a>.  <a href="#name-initiation" class="internal xref">Initiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.2">
                    <p id="section-toc.1-1.5.2.1.2.2.1"><a href="#section-5.1.2" class="auto internal xref">5.1.2</a>.  <a href="#name-response" class="internal xref">Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1.2.3">
                    <p id="section-toc.1-1.5.2.1.2.3.1"><a href="#section-5.1.3" class="auto internal xref">5.1.3</a>.  <a href="#name-finish" class="internal xref">Finish</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="auto internal xref">5.2</a>.  <a href="#name-oquake-specification" class="internal xref">OQUAKE Specification</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.1">
                    <p id="section-toc.1-1.5.2.2.2.1.1"><a href="#section-5.2.1" class="auto internal xref">5.2.1</a>.  <a href="#name-initiation-2" class="internal xref">Initiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.2">
                    <p id="section-toc.1-1.5.2.2.2.2.1"><a href="#section-5.2.2" class="auto internal xref">5.2.2</a>.  <a href="#name-response-2" class="internal xref">Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2.2.3">
                    <p id="section-toc.1-1.5.2.2.2.3.1"><a href="#section-5.2.3" class="auto internal xref">5.2.3</a>.  <a href="#name-finish-2" class="internal xref">Finish</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="auto internal xref">5.3</a>.  <a href="#name-composition-of-cpace-oquake" class="internal xref">Composition of CPace &amp; OQUAKE</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.1">
                    <p id="section-toc.1-1.5.2.3.2.1.1"><a href="#section-5.3.1" class="auto internal xref">5.3.1</a>.  <a href="#name-client-initiation" class="internal xref">Client Initiation</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.2">
                    <p id="section-toc.1-1.5.2.3.2.2.1"><a href="#section-5.3.2" class="auto internal xref">5.3.2</a>.  <a href="#name-server-response" class="internal xref">Server Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.3">
                    <p id="section-toc.1-1.5.2.3.2.3.1"><a href="#section-5.3.3" class="auto internal xref">5.3.3</a>.  <a href="#name-client-finish" class="internal xref">Client Finish</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3.2.4">
                    <p id="section-toc.1-1.5.2.3.2.4.1"><a href="#section-5.3.4" class="auto internal xref">5.3.4</a>.  <a href="#name-server-finish" class="internal xref">Server Finish</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="auto internal xref">6</a>.  <a href="#name-cpaceoquake-protocol-2" class="internal xref">CPaceOQUAKE+ Protocol</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="auto internal xref">6.1</a>.  <a href="#name-registering-clients" class="internal xref">Registering Clients</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.1">
                    <p id="section-toc.1-1.6.2.1.2.1.1"><a href="#section-6.1.1" class="auto internal xref">6.1.1</a>.  <a href="#name-generating-verifiers" class="internal xref">Generating Verifiers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1.2.2">
                    <p id="section-toc.1-1.6.2.1.2.2.1"><a href="#section-6.1.2" class="auto internal xref">6.1.2</a>.  <a href="#name-registration" class="internal xref">Registration</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="auto internal xref">6.2</a>.  <a href="#name-the-password-confirmation-s" class="internal xref">The Password Confirmation Stage</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="auto internal xref">6.2.1</a>.  <a href="#name-server-challenge" class="internal xref">Server Challenge</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="auto internal xref">6.2.2</a>.  <a href="#name-client-response" class="internal xref">Client Response</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="auto internal xref">6.2.3</a>.  <a href="#name-server-verify" class="internal xref">Server Verify</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.3">
                <p id="section-toc.1-1.6.2.3.1"><a href="#section-6.3" class="auto internal xref">6.3</a>.  <a href="#name-composition-of-cpaceoquake-" class="internal xref">Composition of CPaceOQUAKE &amp; Password Confirmation</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="auto internal xref">7</a>.  <a href="#name-cpaceoquake-configurations" class="internal xref">CPaceOQUAKE+ Configurations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="auto internal xref">8</a>.  <a href="#name-implementation-consideratio" class="internal xref">Implementation Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="auto internal xref">9</a>.  <a href="#name-security-considerations" class="internal xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="auto internal xref">10</a>. <a href="#name-iana-considerations" class="internal xref">IANA Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="auto internal xref">11</a>. <a href="#name-references" class="internal xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.1">
                <p id="section-toc.1-1.11.2.1.1"><a href="#section-11.1" class="auto internal xref">11.1</a>.  <a href="#name-normative-references" class="internal xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11.2.2">
                <p id="section-toc.1-1.11.2.2.1"><a href="#section-11.2" class="auto internal xref">11.2</a>.  <a href="#name-informative-references" class="internal xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#appendix-A" class="auto internal xref">Appendix A</a>.  <a href="#name-deriving-parameters" class="internal xref">Deriving parameters</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#appendix-A.1" class="auto internal xref">A.1</a>.  <a href="#name-parameters-for-cpaceoquake" class="internal xref">Parameters for CPaceOQUAKE+</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#appendix-A.2" class="auto internal xref">A.2</a>.  <a href="#name-parameters-for-cpaceoquake-2" class="internal xref">Parameters for CPaceOQUAKE</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.3">
                <p id="section-toc.1-1.12.2.3.1"><a href="#appendix-A.3" class="auto internal xref">A.3</a>.  <a href="#name-parameters-for-cpace" class="internal xref">Parameters for CPace</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.4">
                <p id="section-toc.1-1.12.2.4.1"><a href="#appendix-A.4" class="auto internal xref">A.4</a>.  <a href="#name-parameters-for-oquake" class="internal xref">Parameters for OQUAKE</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-B" class="auto internal xref"></a><a href="#name-authors-addresses" class="internal xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Asymmetric (or Augmented) Password Authenticated Key Exchange (aPAKE)
protocols are designed to provide password authentication and
mutually authenticated key exchange in a client-server setting without
relying on a public key infrastructure (PKI) and without
disclosing passwords to servers or other entities other than the client
machine. The only stage where PKI is required is during a client's registration.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">In the asymmetric PAKE setting, the client first registers a password
verifier with the server. A verifier is a value that is derived from the
password and which the server will later use to verify the client
knowledge of the password. After registration, the client uses its password
and the server uses the corresponding verifier to establish an authenticated
shared secret such that the server learns nothing of the client's password.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">OPAQUE-3DH <span>[<a href="#OPAQUE" class="cite xref">OPAQUE</a>]</span> and SPAKE2+ <span>[<a href="#SPAKE2PLUS" class="cite xref">SPAKE2PLUS</a>]</span>
are two examples of specified aPAKE protocols. These protocols provide security in classical threat models. However, in the presence
of a quantum-capable attacker, both OPAQUE and SPAKE2+ fail to provide the
desired level of security. Both protocols are vulnerable to a Harvest Now, Decrypt
Later attack executed by a quantum-capable attacker, in which the attacker learns the shared secret and uses it
to compromise application traffic. Upgrading both protocols to provide
post-quantum security is non-trivial, especially as there are no known efficient
constructions for certain building blocks used in these protocols (such as the OPRF
used in OPAQUE-3DH). As the threat of quantum-capable attackers looms, the
viability of existing aPAKE protocols in practice diminishes in time.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">This document describes the CPaceOQUAKE+ protocol, an aPAKE that supports mutual
authentication in a client-server setting secure against
quantum-capable attackers. CPaceOQUAKE+ is the result of a KEM-based transformation
from the hybrid symmetric PAKE protocol called CPaceOQUAKE.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">This document fully specifies CPaceOQUAKE+ and all dependencies necessary
to implement it. <a href="#configurations" class="auto internal xref">Section 7</a> provides recommended configurations.<a href="#section-1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<p id="section-2-1">The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>", "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>", "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>", "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
"<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="cite xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="cite xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<div id="notation-and-terminology">
<section id="section-2.1">
        <h3 id="name-notation-and-terminology">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-notation-and-terminology" class="section-name selfRef">Notation and Terminology</a>
        </h3>
<p id="section-2.1-1">The following functions and operators are used throughout the document.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-2.1-2.1">
            <p id="section-2.1-2.1.1">The function <code>random(n)</code> generates a cryptographically secure pseudorandom
byte string of length <code>n</code> bytes.<a href="#section-2.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.2">
            <p id="section-2.1-2.2.1">The associative binary operator <code>||</code> denotes concatenation of two byte strings.<a href="#section-2.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.3">
            <p id="section-2.1-2.3.1">The binary function <code>XOR(a, b)</code> denotes an element-wise XOR operation between
two byte strings <code>a</code> and <code>b</code> of the same length.<a href="#section-2.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.4">
            <p id="section-2.1-2.4.1">The functions <code>bytes_to_int</code> and <code>int_to_bytes</code> convert
byte strings to and from non-negative integers. bytes_to_int and int_to_bytes
are implemented as OS2IP and I2OSP as described in <span>[<a href="#RFC8017" class="cite xref">RFC8017</a>]</span>, respectively.<a href="#section-2.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-2.1-2.5">
            <p id="section-2.1-2.5.1">The function <code>lv_encode</code> encodes a byte string with a two-byte, big-endian
length prefix. For example, lv_enode((0x00, 0x01, 0x02)) = (0x00, 0x03, 0x00, 0x01, 0x02).
The function <code>lv_decode</code> parses a byte string that is expected to be encoded
with a two-byte length preceding the remaining bytes, e.g.,
<code>lv_decode((0x00, 0x03, 0x00, 0x01, 0x02)) = (0x00, 0x01, 0x02)</code>. Note that <code>lv_decode</code>
can fail when the length of the actual bytes does not match that encoded in the
prefix. For example, <code>lv_decode((0xFF, 0xFF, 0x00))</code> will fail.<a href="#section-2.1-2.5.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-2.1-3">All algorithms and procedures described in this document are laid out
in a Python-like pseudocode. Each function takes a set of inputs and parameters
and produces a set of output values. Parameters become constant values once
the protocol variant and the configuration are fixed.<a href="#section-2.1-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="overview">
<section id="section-3">
      <h2 id="name-overview">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-overview" class="section-name selfRef">Overview</a>
      </h2>
<p id="section-3-1">This document aims to specify two protocols: a symmetric and an asymmetric hybrid PAKE.
In the symmetric PAKE setting, the client and server share a password and use it to
establish an authenticated shared secret. In the asymmetric PAKE setting, the client first
registers a password verifier with the server. A verifier is a value that is derived
from the password and which the client will later use to demonstrate knowledge of the password.
After registration, the client uses its password and the server uses the corresponding
verifier to establish an authenticated shared secret such that the server learns nothing
of the client's password.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">The aPAKE specified in this document is composed of multiple smaller protocols, including
the hybrid symmetric PAKE protocol called CPaceOQUAKE. CPaceOQUAKE is in turn a composition of two other
PAKE protocols: the existing CPace <span>[<a href="#CPACE" class="cite xref">CPACE</a>]</span> and a new post-quantum PAKE called OQUAKE.
To achieve the asymmetric property, the aPAKE also builds upon a password
confirmation sub-protocol as specified in <a href="#pcp" class="auto internal xref">Section 6.2</a>.<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">We refer to the fully composed aPAKE as CPaceOQUAKE+.
An abstract overview of the composition of this protocol is shown in the figure below.
In the subsequent sections we break down the sub-protocols into even smaller building blocks.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="section-3-4">
        <div class="alignLeft art-svg artwork" id="section-3-4.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="336" width="376" viewBox="0 0 376 336" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
            <path d="M 104,32 L 104,320" fill="none" stroke="black"></path>
            <path d="M 128,64 L 128,240" fill="none" stroke="black"></path>
            <path d="M 128,272 L 128,288" fill="none" stroke="black"></path>
            <path d="M 144,96 L 144,144" fill="none" stroke="black"></path>
            <path d="M 144,176 L 144,224" fill="none" stroke="black"></path>
            <path d="M 232,96 L 232,144" fill="none" stroke="black"></path>
            <path d="M 232,176 L 232,224" fill="none" stroke="black"></path>
            <path d="M 248,64 L 248,240" fill="none" stroke="black"></path>
            <path d="M 248,272 L 248,288" fill="none" stroke="black"></path>
            <path d="M 272,32 L 272,320" fill="none" stroke="black"></path>
            <path d="M 104,32 L 272,32" fill="none" stroke="black"></path>
            <path d="M 128,64 L 248,64" fill="none" stroke="black"></path>
            <path d="M 144,96 L 232,96" fill="none" stroke="black"></path>
            <path d="M 80,144 L 96,144" fill="none" stroke="black"></path>
            <path d="M 144,144 L 232,144" fill="none" stroke="black"></path>
            <path d="M 280,144 L 296,144" fill="none" stroke="black"></path>
            <path d="M 144,176 L 232,176" fill="none" stroke="black"></path>
            <path d="M 144,224 L 232,224" fill="none" stroke="black"></path>
            <path d="M 128,240 L 248,240" fill="none" stroke="black"></path>
            <path d="M 144,256 L 232,256" fill="none" stroke="black"></path>
            <path d="M 72,288 L 104,288" fill="none" stroke="black"></path>
            <path d="M 272,288 L 304,288" fill="none" stroke="black"></path>
            <path d="M 144,304 L 232,304" fill="none" stroke="black"></path>
            <path d="M 104,320 L 272,320" fill="none" stroke="black"></path>
            <path d="M 144,256 C 135.16936,256 128,263.16936 128,272" fill="none" stroke="black"></path>
            <path d="M 232,256 C 240.83064,256 248,263.16936 248,272" fill="none" stroke="black"></path>
            <path d="M 144,304 C 135.16936,304 128,296.83064 128,288" fill="none" stroke="black"></path>
            <path d="M 232,304 C 240.83064,304 248,296.83064 248,288" fill="none" stroke="black"></path>
            <polygon class="arrowhead" points="312,288 300,282.4 300,293.6" fill="black" transform="rotate(0,304,288)"></polygon>
            <polygon class="arrowhead" points="288,144 276,138.4 276,149.6" fill="black" transform="rotate(180,280,144)"></polygon>
            <polygon class="arrowhead" points="104,144 92,138.4 92,149.6" fill="black" transform="rotate(0,96,144)"></polygon>
            <polygon class="arrowhead" points="80,288 68,282.4 68,293.6" fill="black" transform="rotate(180,72,288)"></polygon>
            <g class="text">
              <text x="164" y="52">CPaceOQUAKE+</text>
              <text x="184" y="84">CPaceOQUAKE</text>
              <text x="184" y="116">CPace</text>
              <text x="36" y="132">Client's</text>
              <text x="188" y="132">protocol</text>
              <text x="36" y="148">password</text>
              <text x="340" y="148">Verifier</text>
              <text x="188" y="196">OQUAKE</text>
              <text x="188" y="212">protocol</text>
              <text x="188" y="276">Password</text>
              <text x="32" y="292">Session</text>
              <text x="188" y="292">confirmation</text>
              <text x="344" y="292">Session</text>
              <text x="32" y="308">key</text>
              <text x="344" y="308">key</text>
            </g>
          </svg><a href="#section-3-4.1" class="pilcrow">¶</a>
</div>
</div>
<p id="section-3-5">We note that this standard only specifies the composition of CPace and OQUAKE.
It is not necessarily true that one can securely compose all PAKEs this way.<a href="#section-3-5" class="pilcrow">¶</a></p>
<p id="section-3-6">The rest of this document specifies CPaceOQUAKE+ and its dependencies. <a href="#CPaceOQUAKE" class="auto internal xref">Section 5</a>
specifies the CPaceOQUAKE protocol, and <a href="#CPaceOQUAKEplus" class="auto internal xref">Section 6</a> specifies the CPaceOQUAKE+ protocol,
incorporating the former protocol. Each of these pieces build upon the cryptographic dependencies
specified in <a href="#crypto-deps" class="auto internal xref">Section 4</a>.<a href="#section-3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="crypto-deps">
<section id="section-4">
      <h2 id="name-cryptographic-dependencies">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-cryptographic-dependencies" class="section-name selfRef">Cryptographic Dependencies</a>
      </h2>
<p id="section-4-1">The protocols in this document have four primary dependencies:<a href="#section-4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4-2.1">
          <p id="section-4-2.1.1">Key Encapsulation Mechanism (KEM); <a href="#deps-kem" class="auto internal xref">Section 4.1</a><a href="#section-4-2.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.2">
          <p id="section-4-2.2.1">Binary Uniform Key Encapsulation Mechanism (BUKEM); <a href="#deps-bukem" class="auto internal xref">Section 4.2</a><a href="#section-4-2.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.3">
          <p id="section-4-2.3.1">Key Derivation Function (KDF); <a href="#deps-symmetric" class="auto internal xref">Section 4.3</a><a href="#section-4-2.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-4-2.4">
          <p id="section-4-2.4.1">Key Stretching Function (KSF); <a href="#deps-ksf" class="auto internal xref">Section 4.4</a><a href="#section-4-2.4.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-4-3"><a href="#configurations" class="auto internal xref">Section 7</a> specifies different combinations of each of these dependencies
that are suitable for implementation.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="deps-kem">
<section id="section-4.1">
        <h3 id="name-key-encapsulation-mechanism">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-key-encapsulation-mechanism" class="section-name selfRef">Key Encapsulation Mechanism</a>
        </h3>
<p id="section-4.1-1">A Key Encapsulation Mechanism (KEM) is an algorithm that is used for exchanging
a secret from one party to another. We require an IND-CCA-secure KEM with key
derivation from a seed. It consists of the following syntax.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.1-2.1">
            <p id="section-4.1-2.1.1">DeriveKeyPair(seed): Deterministic algorithm to derive a key pair
<code>(sk, pk)</code> from the byte string <code>seed</code>, where <code>seed</code> <span class="bcp14">SHOULD</span> have <code>Nseed</code> bytes.<a href="#section-4.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.2">
            <p id="section-4.1-2.2.1">Encaps(pk): Randomized algorithm to generate an ephemeral,
fixed-length symmetric key (the KEM shared secret) and
a fixed-length encapsulation of that key that can be decapsulated
by the holder of the secret key corresponding to <code>pk</code>. This function
can raise an <code>EncapsError</code> on encapsulation failure.<a href="#section-4.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.3">
            <p id="section-4.1-2.3.1">Decaps(ct, skR): Deterministic algorithm using the secret key <code>sk</code>
to recover the ephemeral symmetric key (the KEM shared secret) from
its encapsulated representation <code>ct</code>. This function can raise a
<code>DecapsError</code> on decapsulation failure.<a href="#section-4.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.4">
            <p id="section-4.1-2.4.1">Nseed: The length in bytes of the seed used to derive a key pair.<a href="#section-4.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.5">
            <p id="section-4.1-2.5.1">Nsecret: The length in bytes of a shared secret produced by this KEM.<a href="#section-4.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.6">
            <p id="section-4.1-2.6.1">Nct: The length in bytes of an encapsulated key produced by this KEM.<a href="#section-4.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.7">
            <p id="section-4.1-2.7.1">Npk: The length in bytes of a public key for this KEM.<a href="#section-4.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.1-2.8">
            <p id="section-4.1-2.8.1">Nsk: The length in bytes of a secret key for this KEM.<a href="#section-4.1-2.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-4.1-3">This specification uses X-Wing <span>[<a href="#XWING" class="cite xref">XWING</a>]</span>.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deps-bukem">
<section id="section-4.2">
        <h3 id="name-binary-uniform-kem">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-binary-uniform-kem" class="section-name selfRef">Binary Uniform KEM</a>
        </h3>
<p id="section-4.2-1">A binary uniform KEM supports the same functions as defined above for
a KEM, and it must also be IND-CCA secure, but it must also achieve
two additional security properties. Namely, in addition to IND-CCA
security, a binary uniform KEM requires that:<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-4.2-2">
<li id="section-4.2-2.1">
            <p id="section-4.2-2.1.1">Public keys are indistinguishable from random strings of bytes (of
the same length); and<a href="#section-4.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li id="section-4.2-2.2">
            <p id="section-4.2-2.2.1">Ciphertexts are anonymous in the presence of chosen ciphertext
attack (ANO-CCA).<a href="#section-4.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ol>
<p id="section-4.2-3">These additional properties are crucial for the security of OQUAKE. In
other words, one <span class="bcp14">MUST NOT</span> use a KEM that has no uniform public keys
and no anonymous ciphertexts in place of a uniform KEM.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">This specification uses a variant of ML-KEM768 <span>[<a href="#FIPS203" class="cite xref">FIPS203</a>]</span>, denoted ML-BUKEM768.
This is instantiated with Kemeleon <span>[<a href="#KEMELEON" class="cite xref">KEMELEON</a>]</span>. Note that, while
Kemeleon provides uniform encoding for KEM ciphertexts and public keys, we only
require uniform enoding for public keys. Future specifications can replace use of
Kemeleon with a binary uniform KEM that is more efficient if one becomes available.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deps-symmetric">
<section id="section-4.3">
        <h3 id="name-key-derivation-function">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-key-derivation-function" class="section-name selfRef">Key Derivation Function</a>
        </h3>
<p id="section-4.3-1">A Key Derivation Function (KDF) is a function that takes some source of initial
keying material and uses it to derive one or more cryptographically strong keys.
This specification uses a KDF with the following API and parameters:<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.3-2.1">
            <p id="section-4.3-2.1.1">Extract(salt, ikm): Extract a pseudorandom key of fixed length <code>Nx</code> bytes from
input keying material <code>ikm</code> and an optional byte string <code>salt</code>.<a href="#section-4.3-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.2">
            <p id="section-4.3-2.2.1">Expand(prk, info, L): Expand a pseudorandom key <code>prk</code> using the optional string <code>info</code>
into <code>L</code> bytes of output keying material.<a href="#section-4.3-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-4.3-2.3">
            <p id="section-4.3-2.3.1">Nx: The output size of the <code>Extract()</code> function in bytes.<a href="#section-4.3-2.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
<div id="deps-ksf">
<section id="section-4.4">
        <h3 id="name-key-stretching-function">
<a href="#section-4.4" class="section-number selfRef">4.4. </a><a href="#name-key-stretching-function" class="section-name selfRef">Key Stretching Function</a>
        </h3>
<p id="section-4.4-1">This specification makes use of a Key Stretching Function (KSF), which is a slow
and expensive cryptographic hash function with the following API:<a href="#section-4.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-4.4-2.1">
            <p id="section-4.4-2.1.1">Stretch(msg, salt, L): Apply a key stretching function to stretch the input <code>msg</code>
and salt <code>salt</code>, hardening it against offline dictionary attacks. This function also
needs to satisfy collision resistance. The output is a string of L bytes.<a href="#section-4.4-2.1.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<div id="CPaceOQUAKE">
<section id="section-5">
      <h2 id="name-cpaceoquake-protocol">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-cpaceoquake-protocol" class="section-name selfRef">CPaceOQUAKE Protocol</a>
      </h2>
<p id="section-5-1">The hybrid, symmetric PAKE protocol, denoted CPaceOQUAKE consists of CPace <span>[<a href="#CPace" class="cite xref">CPace</a>]</span>
combined with OQUAKE <span>[<a href="#OQUAKE" class="cite xref">OQUAKE</a>]</span>. At a high level, CPaceOQUAKE
is a two-round protocol that runs between client and server wherein, upon completion, both parties
share the same session key if they agree on the password-related string (PRS).
Otherwise, they obtain random session keys. This is summarized in the diagram below.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="section-5-2">
        <div class="alignLeft art-svg artwork" id="section-5-2.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="208" width="536" viewBox="0 0 536 208" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
            <path d="M 104,32 L 104,192" fill="none" stroke="black"></path>
            <path d="M 224,48 L 224,96" fill="none" stroke="black"></path>
            <path d="M 224,128 L 224,176" fill="none" stroke="black"></path>
            <path d="M 312,48 L 312,96" fill="none" stroke="black"></path>
            <path d="M 312,128 L 312,176" fill="none" stroke="black"></path>
            <path d="M 432,32 L 432,192" fill="none" stroke="black"></path>
            <path d="M 104,32 L 432,32" fill="none" stroke="black"></path>
            <path d="M 224,48 L 312,48" fill="none" stroke="black"></path>
            <path d="M 80,96 L 96,96" fill="none" stroke="black"></path>
            <path d="M 224,96 L 312,96" fill="none" stroke="black"></path>
            <path d="M 440,96 L 456,96" fill="none" stroke="black"></path>
            <path d="M 224,128 L 312,128" fill="none" stroke="black"></path>
            <path d="M 72,160 L 104,160" fill="none" stroke="black"></path>
            <path d="M 432,160 L 456,160" fill="none" stroke="black"></path>
            <path d="M 224,176 L 312,176" fill="none" stroke="black"></path>
            <path d="M 104,192 L 432,192" fill="none" stroke="black"></path>
            <polygon class="arrowhead" points="464,160 452,154.4 452,165.6" fill="black" transform="rotate(0,456,160)"></polygon>
            <polygon class="arrowhead" points="448,96 436,90.4 436,101.6" fill="black" transform="rotate(180,440,96)"></polygon>
            <polygon class="arrowhead" points="104,96 92,90.4 92,101.6" fill="black" transform="rotate(0,96,96)"></polygon>
            <polygon class="arrowhead" points="80,160 68,154.4 68,165.6" fill="black" transform="rotate(180,72,160)"></polygon>
            <g class="text">
              <text x="160" y="52">CPaceOQUAKE</text>
              <text x="264" y="68">CPace</text>
              <text x="36" y="84">Client's</text>
              <text x="268" y="84">protocol</text>
              <text x="500" y="84">Server's</text>
              <text x="36" y="100">password</text>
              <text x="500" y="100">password</text>
              <text x="268" y="148">OQUAKE</text>
              <text x="32" y="164">Session</text>
              <text x="268" y="164">protocol</text>
              <text x="496" y="164">Session</text>
              <text x="32" y="180">key</text>
              <text x="496" y="180">key</text>
            </g>
          </svg><a href="#section-5-2.1" class="pilcrow">¶</a>
</div>
</div>
<p id="section-5-3">CPaceOQUAKE composes CPace and OQUAKE by first running CPace between
client and server, and then incorporating the CPace session key into the password before running
OQUAKE between the server and client. We explain the composition in more detail in <a href="#cpacequake-composition" class="auto internal xref">Section 5.3</a>.<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="cpace">
<section id="section-5.1">
        <h3 id="name-cpace-specification">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-cpace-specification" class="section-name selfRef">CPace Specification</a>
        </h3>
<p id="section-5.1-1">CPace is a classical elliptic curve-based PAKE <span>[<a href="#CPACE" class="cite xref">CPACE</a>]</span>. This section wraps the CPace specification in a consistent interface.
We use an interactive version of CPace that takes two rounds, in which there is a designated initiator and responder.
In other words, the responder only starts executing the protocol after it received the first message from the initiator.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">The flow of the protocol consists of three messages sent between initiator and responder, produced by the functions
Init, Respond, and Finish, described below. Both parties take as input a password-related
string PRS, an optional unique shared session identifier sid, and an optional client identifier
U and server identifier S (e.g., a device identifier, an IP address, or URL pertaining to the
client and server). Upon completion, both parties obtain matching session keys if their PRS, sid, key
length (specified by N), and client and server identifiers match. Otherwise, they obtain random keys.
In exceptional cases, the protocol aborts.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
<div id="initiation">
<section id="section-5.1.1">
          <h4 id="name-initiation">
<a href="#section-5.1.1" class="section-number selfRef">5.1.1. </a><a href="#name-initiation" class="section-name selfRef">Initiation</a>
          </h4>
<p id="section-5.1.1-1">The initiator starts the protocol using its password-related string PRS.
Additionally, it may bind the session to an existing shared session identifier sid.
CPace also allows to bind the session to an existing channel identifier.
To remain consistent with the other PAKEs in this specification, the channel identifier is the concatenation
of optional client and server identifiers.<a href="#section-5.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.1-2">
<pre>
CPace.Init

Input:
- PRS, password-related string, a byte string
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- ya, discrete logarithm intended to be stored in secret until the protocol finishes
- Ya, public point, intended to be sent to the responder

Parameters:
- G, a group environment as specified in CPace

def Init(PRS, sid, U, S):
  g = G.calculate_generator(H, PRS, U || S, sid)
  ya = G.sample_scalar()
  Ya = G.scalar_mult(ya, g)
  return ya, Ya
</pre><a href="#section-5.1.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="response">
<section id="section-5.1.2">
          <h4 id="name-response">
<a href="#section-5.1.2" class="section-number selfRef">5.1.2. </a><a href="#name-response" class="section-name selfRef">Response</a>
          </h4>
<p id="section-5.1.2-1">The responder performs the same actions as the initiator.
Since it already received the initiator's message, it can immediately finish its execution of the protocol.
It outputs the shared secret and a message Yb intended to be sent to the initiator.<a href="#section-5.1.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.2-2">
<pre>
CPace.Respond

Input:
- PRS, password-related string, a byte string
- Ya, public point, received from the initiator
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- ISK, the established shared secret
- Yb, public point, intended to be sent to the initiator

Parameters:
- G, a group environment as specified in CPace
- H, a hash function as specified in CPace

Exceptions:
- CPaceError, raised when an invalid value was encountered in CPace

def Respond(PRS, Ya, sid, U, S):
  g = G.calculate_generator(H, PRS, U || S, sid)
  yb = G.sample_scalar()
  Yb = G.scalar_mult(yb, g)

  K = G.scalar_mult_vfy(yb, Ya)
  If K = G.I, raise CPaceError

  ISK = H.hash(lv_cat(G.DSI || b"_ISK", sid, K) || transcript(Ya, Yb))

  return ISK, Yb
</pre><a href="#section-5.1.2-2" class="pilcrow">¶</a>
</div>
<p id="section-5.1.2-3">The functions <code>lv_cat</code> and <code>transcript</code> are defined in <span>[<a href="#CPACE" class="cite xref">CPACE</a>]</span>.<a href="#section-5.1.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="finish">
<section id="section-5.1.3">
          <h4 id="name-finish">
<a href="#section-5.1.3" class="section-number selfRef">5.1.3. </a><a href="#name-finish" class="section-name selfRef">Finish</a>
          </h4>
<p id="section-5.1.3-1">The initiator finishes the protocol by combining the discrete logarithm ya generated by CPace.Init and the message Yb received
from the responder.<a href="#section-5.1.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.1.3-2">
<pre>
CPace.Finish

Input:
- PRS, password-related string, a byte string
- ya, discrete logarithm that was generated using CPace.Init
- Yb, public point, received from the responder
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- ISK, the established shared secret

Parameters:
- G, a group environment as specified in CPace
- H, a hash function as specified in CPace

Exceptions:
- CPaceError, raised when an invalid value was encountered in CPace

def Finish(PRS, ya, Yb, sid):
  K = G.scalar_mult_vfy(yb, Ya)
  If K = G.I, raise CPaceError

  ISK = H.hash(lv_cat(G.DSI || b"_ISK", sid, K) || transcript(Ya, Yb))

  return ISK
</pre><a href="#section-5.1.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="quake">
<section id="section-5.2">
        <h3 id="name-oquake-specification">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-oquake-specification" class="section-name selfRef">OQUAKE Specification</a>
        </h3>
<p id="section-5.2-1">OQUAKE is a PAKE built on a BUKEM and KDF.  If the BUKEM provides security against quantum-enabled attacks,
then so does OQUAKE. It consists of three messages sent between initiator and responder, produced by
the functions Init, Respond, and Finish, described below. Both parties take as input a password-related
string PRS, a required unique shared session identifier sid, and an optional client identifier U and server
identifier S. Upon completion, both parties obtain matching session keys if their PRS, sid, key length
(specified by N), and client and server identifiers match. Otherwise, they obtain random session keys.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">The shared session identifier has the following requirements. If a client and server identifier are provided:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">
            <p id="section-5.2-3.1.1">The session identifier must match between the client and server<a href="#section-5.2-3.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-3.2">
            <p id="section-5.2-3.2.1">This session identifier has not been used before in a session between the client and server<a href="#section-5.2-3.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-4">If no client and server identifiers are provided:<a href="#section-5.2-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-5.1">
            <p id="section-5.2-5.1.1">The session identifier must match between the client and server<a href="#section-5.2-5.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="section-5.2-5.2">
            <p id="section-5.2-5.2.1">This session identifier has not been used before by the client or server in any session with any other party<a href="#section-5.2-5.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="section-5.2-6">These requirements originate from the security proof for OQUAKE. If these requirements are not met, the proof
does not apply, but this does not mean that the protocol becomes vulnerable.<a href="#section-5.2-6" class="pilcrow">¶</a></p>
<div id="initiation-1">
<section id="section-5.2.1">
          <h4 id="name-initiation-2">
<a href="#section-5.2.1" class="section-number selfRef">5.2.1. </a><a href="#name-initiation-2" class="section-name selfRef">Initiation</a>
          </h4>
<p id="section-5.2.1-1">Init takes as input the initiator's PRS, session identifier sid, and optional client and server identifiers
U and S. It produces a context for the initiator to store, as well as a protocol message that is sent to
the responder. Its implementation is as follows.<a href="#section-5.2.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2.1-2">
<pre>
OQUAKE.Init

Input:
- PRS, password-related string, a byte string
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- context, opaque state for the initiator to store
- msg, an encoded protocol message for the initiator to send to the responder

Parameters:
- BUKEM, a BUKEM instance
- KDF, a KDF instance
- DST, domain separation tag, a byte string

def Init(PRS, sid, U, S):
  seed = random(BUKEM.Nseed)
  (pk, sk) = BUKEM.DeriveKeyPair(seed)

  r = random(3 * Nsec)

  fullsid = encode_sid(sid, U, S)

  // T = XOR(pk, H(fullsid, PRS, r))
  prk_T_pad = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || r)
  T_pad = KDF.Expand(prk_T_pad, DST || "T_pad", Npk)
  T = XOR(pk, T_pad)

  // s = XOR(r, H(fullsid, PRS, T))
  prk_s_pad = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || T)
  s_pad = KDF.Expand(prk_s_pad, DST || "s_pad", 3 * Nsec)
  s = XOR(r, s_pad)

  init_msg = s || T

  return Context(PRS, sk, s, T, fullsid), init_msg
</pre><a href="#section-5.2.1-2" class="pilcrow">¶</a>
</div>
<p id="section-5.2.1-3">The encode_sid function is defined below.<a href="#section-5.2.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2.1-4">
<pre>
encode_sid

Input:
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- fullsid, a byte string

Parameters:
- BUKEM, a BUKEM instance
- KDF, a KDF instance

def encode_sid(sid, U, U):
  fullsid =
    bytes_to_int(len(sid), 4) || sid ||
    bytes_to_int(len(U), 4) || U ||
    bytes_to_int(len(S), 4) || S
  return fullsid
</pre><a href="#section-5.2.1-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="response-1">
<section id="section-5.2.2">
          <h4 id="name-response-2">
<a href="#section-5.2.2" class="section-number selfRef">5.2.2. </a><a href="#name-response-2" class="section-name selfRef">Response</a>
          </h4>
<p id="section-5.2.2-1">Respond takes as input the PRS, session identifier sid, the initiator's
protocol message, and optional client and server identifiers.
It produces a 32-byte symmetric key and a protocol message intended to be sent to the initiator. Its implementation
is as follows.<a href="#section-5.2.2-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2.2-2">
<pre>
OQUAKE.Respond

Input:
- PRS, password-related string, a byte string
- init_msg, encoded protocol message, a byte string
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- ss, output shared secret, a byte string of 32 bytes
- resp_msg, encoded protocol message, a byte string

Parameters:
- BUKEM, a BUKEM instance
- KDF, a KDF instance
- DST, domain separation tag, a byte string

def Respond(PRS, init_msg, sid, U, S):
  (s, T) = init_msg[0..(3 * Nsec)], init_msg[(3 * Nsec)..]

  fullsid = encode_sid(sid, U, S)
  prk_s_pad = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || T)
  s_pad = KDF.Expand(prk_s_pad, DST || "s_pad", 3 * Nsec)
  r = XOR(s, s_pad)

  prk_T_pad = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || r)
  T_pad = KDF.Expand(prk_T_pad, DST || "T_pad", Npk)
  pk = XOR(T, T_pad)

  (ct, k) = BUKEM.Encaps(pk)

  prk_sk = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || k)
  key = KDF.Expand(prk_sk, DST || "sk", Nkey)

  h = KDF.Expand(prk_sk, DST || "confirm", Nkc)

  resp_msg = ct || h

  return resp_msg, key
</pre><a href="#section-5.2.2-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="quake-finish">
<section id="section-5.2.3">
          <h4 id="name-finish-2">
<a href="#section-5.2.3" class="section-number selfRef">5.2.3. </a><a href="#name-finish-2" class="section-name selfRef">Finish</a>
          </h4>
<p id="section-5.2.3-1">Finish takes as input the initiator-created context that is output from Init
as well as the responder's reply message resp_msg. It produces a symmetric key
that is output to the initiator. Its implementation
is as follows.<a href="#section-5.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.2.3-2">
<pre>
OQUAKE.Finish

Input:
- context, opaque state for the initiator to store TODO
- resp_msg, encoded protocol message, a byte string

Output:
- ss, output shared secret, a byte string of 32 bytes

Parameters:
- BUKEM, a BUKEM instance
- KDF, a KDF instance
- DST, domain separation tag, a byte string

Exceptions:
- AuthenticationError, raised when the key confirmation fails

def Finish(context, resp_msg):
  (PRS, sk, s, T, fullsid) = context
  ct, h = resp_msg[0..Npk], resp_msg[Npk..]

  try:
    k = BUKEM.Decaps(sk, ct)
    prk_sk = KDF.Extract(PRS, DST || "OQUAKE" || fullsid || k)
    key = KDF.Expand(prk_sk, DST || "sk", Nkey)

    h_expected = KDF.Expand(prk_sk, DST || "confirm", Nkc)
    if h != h_expected:
      return random(Nkey)

    return key
  catch DecapsError:
    return random(Nkey)
</pre><a href="#section-5.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="cpacequake-composition">
<section id="section-5.3">
        <h3 id="name-composition-of-cpace-oquake">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-composition-of-cpace-oquake" class="section-name selfRef">Composition of CPace &amp; OQUAKE</a>
        </h3>
<p id="section-5.3-1">CPaceOQUAKE is a sequential composition of CPace (see <a href="#cpace" class="auto internal xref">Section 5.1</a>) and
OQUAKE (see <a href="#quake" class="auto internal xref">Section 5.2</a>). Whereas running CPace and OQUAKE in parallel realizes
a worst-of-both worlds PAKE, this sequential composition realizes a
best-of-both worlds PAKE. In other words, CPaceOQUAKE remains as secure
as the strongest PAKE, resisting attacks that break the classical CPace
(e.g. by a quantum-capable attacker) or attacks that break the
quantum-resistant OQUAKE (e.g. by a flaw in the BUKEM). This assumes that
OQUAKE is instantiated with a quantum-resistant BUKEM.<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">To be precise, CPaceOQUAKE first runs CPace using password-related string PRS,
establishing a session key SK1 with the associated transcript tr1. It
then initiates OQUAKE using the password-related string <code>H(fullsid, PRS, tr1, SK1)</code>;
a secret derived from the the original password-related string and the outputs from
the CPace instance. Here, <code>fullsid</code> is the output of encode_sid(sid, U, S).
The final session key is then a hash of fullsid, the original password-related string,
both CPace and OQUAKE transcripts (tr1 and tr2, respectively), and both session keys
output from CPace and OQUAKE (SK1 and SK2, respectively), i.e.,
H(fullsid, tr1, tr2, SK1, SK2).<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">This is outlined in the diagram below. In CPaceOQUAKE, CPace is initiated by the
first party, while OQUAKE is initiated by the other party. This results in a protocol
that requires three messages.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
<div id="section-5.3-4">
          <div class="alignLeft art-svg artwork" id="section-5.3-4.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="208" width="848" viewBox="0 0 848 208" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 104,32 L 104,56" fill="none" stroke="black"></path>
              <path d="M 104,72 L 104,152" fill="none" stroke="black"></path>
              <path d="M 104,168 L 104,192" fill="none" stroke="black"></path>
              <path d="M 216,64 L 216,128" fill="none" stroke="black"></path>
              <path d="M 296,80 L 296,128" fill="none" stroke="black"></path>
              <path d="M 376,48 L 376,96" fill="none" stroke="black"></path>
              <path d="M 376,128 L 376,176" fill="none" stroke="black"></path>
              <path d="M 464,48 L 464,96" fill="none" stroke="black"></path>
              <path d="M 464,128 L 464,176" fill="none" stroke="black"></path>
              <path d="M 480,80 L 480,112" fill="none" stroke="black"></path>
              <path d="M 592,64 L 592,104" fill="none" stroke="black"></path>
              <path d="M 592,120 L 592,128" fill="none" stroke="black"></path>
              <path d="M 672,112 L 672,128" fill="none" stroke="black"></path>
              <path d="M 744,32 L 744,56" fill="none" stroke="black"></path>
              <path d="M 744,72 L 744,152" fill="none" stroke="black"></path>
              <path d="M 744,168 L 744,192" fill="none" stroke="black"></path>
              <path d="M 104,32 L 744,32" fill="none" stroke="black"></path>
              <path d="M 376,48 L 464,48" fill="none" stroke="black"></path>
              <path d="M 80,64 L 240,64" fill="none" stroke="black"></path>
              <path d="M 272,64 L 368,64" fill="none" stroke="black"></path>
              <path d="M 472,64 L 488,64" fill="none" stroke="black"></path>
              <path d="M 520,64 L 768,64" fill="none" stroke="black"></path>
              <path d="M 296,80 L 376,80" fill="none" stroke="black"></path>
              <path d="M 464,80 L 480,80" fill="none" stroke="black"></path>
              <path d="M 376,96 L 464,96" fill="none" stroke="black"></path>
              <path d="M 480,112 L 672,112" fill="none" stroke="black"></path>
              <path d="M 376,128 L 464,128" fill="none" stroke="black"></path>
              <path d="M 312,144 L 368,144" fill="none" stroke="black"></path>
              <path d="M 472,144 L 488,144" fill="none" stroke="black"></path>
              <path d="M 72,160 L 112,160" fill="none" stroke="black"></path>
              <path d="M 352,160 L 376,160" fill="none" stroke="black"></path>
              <path d="M 464,160 L 488,160" fill="none" stroke="black"></path>
              <path d="M 728,160 L 768,160" fill="none" stroke="black"></path>
              <path d="M 376,176 L 464,176" fill="none" stroke="black"></path>
              <path d="M 104,192 L 744,192" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="776,160 764,154.4 764,165.6" fill="black" transform="rotate(0,768,160)"></polygon>
              <path class="jump" d="M 744,168 C 738,168 738,152 744,152" fill="none" stroke="black"></path>
              <path class="jump" d="M 744,72 C 738,72 738,56 744,56" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="680,128 668,122.4 668,133.6" fill="black" transform="rotate(90,672,128)"></polygon>
              <polygon class="arrowhead" points="600,128 588,122.4 588,133.6" fill="black" transform="rotate(90,592,128)"></polygon>
              <path class="jump" d="M 592,120 C 586,120 586,104 592,104" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="480,144 468,138.4 468,149.6" fill="black" transform="rotate(180,472,144)"></polygon>
              <polygon class="arrowhead" points="480,64 468,58.4 468,69.6" fill="black" transform="rotate(180,472,64)"></polygon>
              <polygon class="arrowhead" points="376,144 364,138.4 364,149.6" fill="black" transform="rotate(0,368,144)"></polygon>
              <polygon class="arrowhead" points="376,64 364,58.4 364,69.6" fill="black" transform="rotate(0,368,64)"></polygon>
              <polygon class="arrowhead" points="304,128 292,122.4 292,133.6" fill="black" transform="rotate(90,296,128)"></polygon>
              <polygon class="arrowhead" points="224,128 212,122.4 212,133.6" fill="black" transform="rotate(90,216,128)"></polygon>
              <path class="jump" d="M 104,168 C 110,168 110,152 104,152" fill="none" stroke="black"></path>
              <path class="jump" d="M 104,72 C 110,72 110,56 104,56" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="80,160 68,154.4 68,165.6" fill="black" transform="rotate(180,72,160)"></polygon>
              <g class="text">
                <text x="36" y="52">Client's</text>
                <text x="160" y="52">CPaceOQUAKE</text>
                <text x="812" y="52">Server's</text>
                <text x="36" y="68">password</text>
                <text x="256" y="68">PRS</text>
                <text x="416" y="68">CPace</text>
                <text x="504" y="68">PRS</text>
                <text x="812" y="68">password</text>
                <text x="420" y="84">protocol</text>
                <text x="156" y="148">H(fullsid,</text>
                <text x="220" y="148">PRS,</text>
                <text x="260" y="148">tr1,</text>
                <text x="296" y="148">SK1</text>
                <text x="420" y="148">OQUAKE</text>
                <text x="532" y="148">H(fullsid,</text>
                <text x="596" y="148">PRS,</text>
                <text x="636" y="148">tr1,</text>
                <text x="676" y="148">SK1)</text>
                <text x="32" y="164">Session</text>
                <text x="156" y="164">H(fullsid,</text>
                <text x="220" y="164">tr1,</text>
                <text x="260" y="164">tr2,</text>
                <text x="300" y="164">SK1,</text>
                <text x="336" y="164">SK2</text>
                <text x="420" y="164">protocol</text>
                <text x="532" y="164">H(fullsid,</text>
                <text x="596" y="164">tr1,</text>
                <text x="636" y="164">tr2,</text>
                <text x="676" y="164">SK1,</text>
                <text x="712" y="164">SK2</text>
                <text x="808" y="164">Session</text>
                <text x="32" y="180">key</text>
                <text x="808" y="180">key</text>
              </g>
            </svg><a href="#section-5.3-4.1" class="pilcrow">¶</a>
</div>
</div>
<p id="section-5.3-5">Unlike OQUAKE, CPaceOQUAKE does not require a shared session identifier sid, although this
is strongly recommended. If no sid is provided, CPace will run without an sid, and OQUAKE
will use a random string generated with random material provided by both parties. If an
sid is provided, both CPace and OQUAKE will use this sid.<a href="#section-5.3-5" class="pilcrow">¶</a></p>
<p id="section-5.3-6">An overview of the protocol flow is shown below. The protocol has four functions. Init and
InitiatorFinish are intended to be called by the initiator, and Respond and ResponderFinish
are intended to be called by the responder. The following subsections specify these functions.<a href="#section-5.3-6" class="pilcrow">¶</a></p>
<div id="section-5.3-7">
          <div class="alignLeft art-svg artwork" id="section-5.3-7.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="432" width="520" viewBox="0 0 520 432" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 112,96 L 112,240" fill="none" stroke="black"></path>
              <path d="M 112,304 L 112,392" fill="none" stroke="black"></path>
              <path d="M 136,64 L 136,72" fill="none" stroke="black"></path>
              <path d="M 352,96 L 352,144" fill="none" stroke="black"></path>
              <path d="M 352,184 L 352,256" fill="none" stroke="black"></path>
              <path d="M 352,288 L 352,336" fill="none" stroke="black"></path>
              <path d="M 72,48 L 392,48" fill="none" stroke="black"></path>
              <path d="M 120,128 L 344,128" fill="none" stroke="black"></path>
              <path d="M 120,224 L 344,224" fill="none" stroke="black"></path>
              <path d="M 120,320 L 344,320" fill="none" stroke="black"></path>
              <path d="M 72,400 L 392,400" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="352,320 340,314.4 340,325.6" fill="black" transform="rotate(0,344,320)"></polygon>
              <polygon class="arrowhead" points="352,128 340,122.4 340,133.6" fill="black" transform="rotate(0,344,128)"></polygon>
              <polygon class="arrowhead" points="128,224 116,218.4 116,229.6" fill="black" transform="rotate(180,120,224)"></polygon>
              <g class="text">
                <text x="32" y="36">Client:</text>
                <text x="112" y="36">PRS,sid,U,S</text>
                <text x="240" y="36">Server:</text>
                <text x="320" y="36">PRS,sid,U,S</text>
                <text x="64" y="68">ctx1,</text>
                <text x="112" y="68">(msg1</text>
                <text x="160" y="68">s1)</text>
                <text x="184" y="68">=</text>
                <text x="352" y="68">|</text>
                <text x="120" y="84">CPaceOQUAKE.Init(PRS,sid,U,S)</text>
                <text x="360" y="84">|</text>
                <text x="208" y="116">msg1,</text>
                <text x="244" y="116">s1</text>
                <text x="264" y="164">ctx2,</text>
                <text x="316" y="164">(msg2,</text>
                <text x="368" y="164">msg3,</text>
                <text x="408" y="164">s2)</text>
                <text x="432" y="164">=</text>
                <text x="324" y="180">CPaceOQUAKE.Respond(PRS,(msg1,s1),sid,U,S)</text>
                <text x="192" y="212">msg2,</text>
                <text x="240" y="212">msg3,</text>
                <text x="276" y="212">s2</text>
                <text x="80" y="260">client_key,</text>
                <text x="148" y="260">msg4</text>
                <text x="176" y="260">=</text>
                <text x="132" y="276">CPaceOQUAKE.InitiatorFinish(PRS,</text>
                <text x="280" y="276">...</text>
                <text x="360" y="276">|</text>
                <text x="136" y="292">(ctx1,s1),(msg2,msg3,s2),sid,U,S)</text>
                <text x="228" y="308">msg4</text>
                <text x="340" y="356">server_key</text>
                <text x="392" y="356">=</text>
                <text x="336" y="372">CPaceOQUAKE.ResponderFinish(ctx2,</text>
                <text x="496" y="372">msg4)</text>
                <text x="352" y="388">|</text>
                <text x="68" y="420">output</text>
                <text x="140" y="420">client_key</text>
                <text x="316" y="420">output</text>
                <text x="388" y="420">server_key</text>
              </g>
            </svg><a href="#section-5.3-7.1" class="pilcrow">¶</a>
</div>
</div>
<div id="client-initiation">
<section id="section-5.3.1">
          <h4 id="name-client-initiation">
<a href="#section-5.3.1" class="section-number selfRef">5.3.1. </a><a href="#name-client-initiation" class="section-name selfRef">Client Initiation</a>
          </h4>
<p id="section-5.3.1-1">The client initiates a CPace exchange with the server using input PRS, an optional session identifier sid,
and optional client and server identifiers U and S. The output of this process is some context for
completing the protocol and a protocol message. The client sends this message to the server.<a href="#section-5.3.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.1-2">
<pre>
CPaceOQUAKE.Init

Input:
- PRS, password-related string, a byte string
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- context, opaque state for the initiator to store
- msg, an encoded protocol message for the initiator to send to the responder

Parameters:
- CPace, parameterized instance of CPace

def Init(PRS, sid, U, S):
  ctx1, msg1 = CPace.Init(PRS, sid, U, S)
  s1 = random(32)
  init_msg = s1 || lv_encode(msg1)

  return (ctx1, s1), init_msg
</pre><a href="#section-5.3.1-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="server-response">
<section id="section-5.3.2">
          <h4 id="name-server-response">
<a href="#section-5.3.2" class="section-number selfRef">5.3.2. </a><a href="#name-server-response" class="section-name selfRef">Server Response</a>
          </h4>
<p id="section-5.3.2-1">The server processes the client message using its input PRS, an optional session identifier sid, and
optional client and server identifiers U and S. The first output of this function is a context that
is used to finish the protocol later. The second output is a protocol message intended for the client.<a href="#section-5.3.2-1" class="pilcrow">¶</a></p>
<p id="section-5.3.2-2">The server responds to the CPace session that the client initiated, and it initiates a new OQUAKE
session using both the PRS and the key established by CPace.<a href="#section-5.3.2-2" class="pilcrow">¶</a></p>
<p id="section-5.3.2-3">The server <span class="bcp14">MUST</span> ensure that exactly one of <code>s1</code> and <code>sid</code> exists. It <span class="bcp14">MUST</span> abort if the message does
not have the correct length.<a href="#section-5.3.2-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.2-4">
<pre>
CPaceOQUAKE.Respond

Input:
- PRS, password-related string, a byte string
- init_msg, the message received from the client
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- context, opaque state for the responder to store
- msg, an encoded protocol message for the responder to send to the initiator

Parameters:
- CPace, parameterized instance of CPace
- OQUAKE, parameterized instance of OQUAKE
- DST, domain separation tag, a byte string

def Respond(PRS, init_msg, sid, U, S):
  s1, msg1 = init_msg[0..32], lv_decode(init_msg[32..])

  key1, msg2 = CPace.Respond(PRS, msg1, sid, U, S)
  key1A = KDF.Expand(key1, DST || "prskey", Nkey)
  key1B = KDF.Expand(key1, DST || "outputkey", Nkey)

  s2 = random(32)
  extended_sid_prk = KDF.Extract(s1 || s2, DST || "CPaceOQUAKE")
  extended_sid = KDF.Expand(extended_sid_prk, DST || "SID", 32)

  fullsid = encode_sid(extended_sid, U, S)

  PRS2_prk = KDF.Extract(PRS, DST || "CPaceOQUAKE" || fullsid || msg1 || msg2 || key1A)
  PRS2 = KDF.Expand(PRS2_prk, DST || "PRS2", Nkey)

  ctx2, msg3 = OQUAKE.Init(PRS2, extended_sid, U, S)

  resp_msg = s2 || lv_encode(msg2) || lv_encode(msg3)

  return Context(fullsid, PRS, msg1, msg2, msg3, key1B, ctx2), resp_msg
</pre><a href="#section-5.3.2-4" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="client-finish">
<section id="section-5.3.3">
          <h4 id="name-client-finish">
<a href="#section-5.3.3" class="section-number selfRef">5.3.3. </a><a href="#name-client-finish" class="section-name selfRef">Client Finish</a>
          </h4>
<p id="section-5.3.3-1">The client finishes the protocol by processing the server response. The client obtains a
shared secret and a final message intended for the server. It does so by finishing the
CPace session and responding to the OQUAKE session.<a href="#section-5.3.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3.3-2">The client must ensure that exactly one of (s1, s2) and sid exists.
The client should abort when the message does not have the correct length.<a href="#section-5.3.3-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.3-3">
<pre>
CPaceOQUAKE.InitiatorFinish

Input:
- PRS, password-related string, a byte string
- (ctx1, s1), the context generated by CPaceOQUAKE.Init
- resp_msg, the message received from the server
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- key, an N-byte shared secret
- msg, an encoded protocol message for the initiator to send to the responder

Parameters:
- CPace, parameterized instance of CPace
- OQUAKE, parameterized instance of OQUAKE
- DST, domain separation tag, a byte string

def InitiatorFinish(PRS, (ctx1, s1), (msg2, msg3, s2), sid, U, S):
  s2 = resp_msg[0..32]
  msg2 = lv_decode(resp_msg[32..])
  msg3 = lv_decode(resp_msg[32+len(msg2)..])

  key1 = CPace.Finish(ctx1, msg2, sid, U, S)
  key1A = KDF.Expand(key1, DST || "prskey", Nkey)
  key1B = KDF.Expand(key1, DST || "outputkey", Nkey)

  extended_sid_prk = KDF.Extract(s1 || s2, DST || "CPaceOQUAKE")
  extended_sid = KDF.Expand(extended_sid_prk, DST || "SID", 32)

  fullsid = encode_sid(extended_sid, U, S)
  PRS2_prk = KDF.Extract(PRS, DST || "CPaceOQUAKE" || fullsid || msg1 || msg2 || key1A)
  PRS2 = KDF.Expand(PRS2_prk, DST || "PRS2", Nkey)

  key2, msg4 = OQUAKE.Respond(PRS2, extended_sid, msg3, Nkey, U, S)

  sessionkey_prk = KDF.Extract(PRS, DST || "CPaceOQUAKE" || fullsid || msg1 || msg2 || msg3 || msg4 || key1B || key2)
  client_key = KDF.Expand(sessionkey_prk, DST || "sessionkey", Nkey)

  return client_key, msg4
</pre><a href="#section-5.3.3-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="server-finish">
<section id="section-5.3.4">
          <h4 id="name-server-finish">
<a href="#section-5.3.4" class="section-number selfRef">5.3.4. </a><a href="#name-server-finish" class="section-name selfRef">Server Finish</a>
          </h4>
<p id="section-5.3.4-1">The server finishes the protocol by finising OQUAKE using the client's response, outputting a shared secret of N bytes.
It should abort when the message does not have the correct length.<a href="#section-5.3.4-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-5.3.4-2">
<pre>
CPaceOQUAKE.ResponderFinish

Input:
- ctx, context from the server's Response
- msg4, the message received from the server, a byte string

Output:
- key, an N-byte shared secret

Parameters:
- OQUAKE, parameterized instance of OQUAKE
- DST, domain separation tag, a byte string

def ResponderFinish(ctx, msg4):
  (fullsid, PRS, msg1, msg2, msg3, key1B, ctx2) = ctx

  key2 = OQUAKE.Finish(ctx2, msg4)

  sessionkey_prk = KDF.Extract(PRS, DST || "CPaceOQUAKE" || fullsid || msg1 || msg2 || msg3 || msg4 || key1B || key2)
  server_key = KDF.Expand(sessionkey_prk, DST || "sessionkey", Nkey)

  return server_key
</pre><a href="#section-5.3.4-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="CPaceOQUAKEplus">
<section id="section-6">
      <h2 id="name-cpaceoquake-protocol-2">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-cpaceoquake-protocol-2" class="section-name selfRef">CPaceOQUAKE+ Protocol</a>
      </h2>
<p id="section-6-1">CPaceOQUAKE+ is the 5 message aPAKE resulting from applying a KEM-based
PAKE-to-aPAKE transformation to CPaceOQUAKE. At a high level, this
involves running CPaceOQUAKE on a verifier of the client's password.
To ensure that the client does indeed know the password pertaining
to that verifier, there is an additional password confirmation
stage that uses seed derived from the password. Both the verifier and
the seed are derived from the password using a key stretching function.
The seed is later used to derive a KEM public key. We refer to the collection
of the verifier and this public key as 'the verifiers'.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="registering-clients">
<section id="section-6.1">
        <h3 id="name-registering-clients">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-registering-clients" class="section-name selfRef">Registering Clients</a>
        </h3>
<p id="section-6.1-1">This subsection specifies functions for generating the verifiers and
a protocol for registering clients.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<div id="generating-verifiers">
<section id="section-6.1.1">
          <h4 id="name-generating-verifiers">
<a href="#section-6.1.1" class="section-number selfRef">6.1.1. </a><a href="#name-generating-verifiers" class="section-name selfRef">Generating Verifiers</a>
          </h4>
<p id="section-6.1.1-1">Verifiers are random-looking value derived from password-related strings
from which it is computionally impractical to derive the password-related
string. To make verifiers unique between different users with the same
password or servers that they interact with, we employ a salt, a user
account identifier, and an optional server identifier. The material
required for the verifiers is generated as follows:<a href="#section-6.1.1-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1.1-2">
<pre>
GenVerifierMaterial

Input:
- PRS, password-related string, a byte string
- salt, client-specific salt, a byte string
- U and S, client and server identifiers

Output:
- ss, output shared secret, a byte string of 32 bytes
- resp_msg, encoded protocol message, a byte string

Parameters:
- KSF, a parameterized KSF instance
- DST, domain separation tag, a byte string

def GenVerifierMaterial(PRS, salt, U, S):
  verifier_seed = KSF.Stretch(DST || PRS || U || S, salt, Nverifier + Nseed)
  verifier = verifier_seed[0:Nverifier]
  seed = verifier_seed[Nverifier:Nverifier + Nseed]
  return verifier, seed
</pre><a href="#section-6.1.1-2" class="pilcrow">¶</a>
</div>
<p id="section-6.1.1-3">To derive an actual public key from the verifier material, we use the following function:<a href="#section-6.1.1-3" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.1.1-4">
<pre>
GenVerifiers

Input:
- PRS, password-related string, a byte string
- salt, client-specific salt, a byte string
- U and S, client and server identifiers

Output:
- ss, output shared secret, a byte string of 32 bytes
- resp_msg, encoded protocol message, a byte string

Parameters:
- KEM, a KEM instance

def GenVerifiers(PRS, salt, U, S):
  verifier, seed = GenVerifierMaterial(PRS, salt, U, S)
  (pk, sk) = KEM.DeriveKeyPair(seed)
  return verifier, pk
</pre><a href="#section-6.1.1-4" class="pilcrow">¶</a>
</div>
<p id="section-6.1.1-5">The server <span class="bcp14">MUST</span> store pk; it <span class="bcp14">MUST NOT</span> store seed.<a href="#section-6.1.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration">
<section id="section-6.1.2">
          <h4 id="name-registration">
<a href="#section-6.1.2" class="section-number selfRef">6.1.2. </a><a href="#name-registration" class="section-name selfRef">Registration</a>
          </h4>
<p id="section-6.1.2-1">The registration phase consists of one message sent from the client to the server. This message
contains the verifier, a public key, and 32-byte salt. The server stores this information corresponding to
the client for future use in the verification flow. This phase requires a secure channel from client to
server in order to transfer the password verifier and public key.
The salt can be sent in plain text.<a href="#section-6.1.2-1" class="pilcrow">¶</a></p>
<p id="section-6.1.2-2">We recommend that the salt is a random byte string: <code>salt = random(32)</code>. However, in practice this may require
additional communication flows. Instead, one may consider deriving the salt from some client-specific value that it knows locally.<a href="#section-6.1.2-2" class="pilcrow">¶</a></p>
<p id="section-6.1.2-3">A high level flow overview of the registration flow is below.<a href="#section-6.1.2-3" class="pilcrow">¶</a></p>
<div id="section-6.1.2-4">
            <div class="alignLeft art-svg artwork" id="section-6.1.2-4.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="192" width="416" viewBox="0 0 416 192" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
                <path d="M 104,80 L 104,168" fill="none" stroke="black"></path>
                <path d="M 328,80 L 328,128" fill="none" stroke="black"></path>
                <path d="M 64,48 L 368,48" fill="none" stroke="black"></path>
                <path d="M 112,112 L 320,112" fill="none" stroke="black"></path>
                <path d="M 64,176 L 368,176" fill="none" stroke="black"></path>
                <polygon class="arrowhead" points="328,112 316,106.4 316,117.6" fill="black" transform="rotate(0,320,112)"></polygon>
                <g class="text">
                  <text x="32" y="36">Client:</text>
                  <text x="84" y="36">PRS,</text>
                  <text x="128" y="36">salt,</text>
                  <text x="164" y="36">U,</text>
                  <text x="184" y="36">S</text>
                  <text x="328" y="36">Server:</text>
                  <text x="376" y="36">N/A</text>
                  <text x="24" y="68">(v,</text>
                  <text x="56" y="68">pk)</text>
                  <text x="80" y="68">=</text>
                  <text x="160" y="68">GenVerifiers(PRS,</text>
                  <text x="256" y="68">salt,</text>
                  <text x="292" y="68">U,</text>
                  <text x="316" y="68">S)</text>
                  <text x="184" y="100">salt,</text>
                  <text x="220" y="100">v,</text>
                  <text x="244" y="100">pk</text>
                  <text x="280" y="148">Store</text>
                  <text x="332" y="148">(salt,</text>
                  <text x="372" y="148">v,</text>
                  <text x="400" y="148">pk)</text>
                  <text x="328" y="164">|</text>
                </g>
              </svg><a href="#section-6.1.2-4.1" class="pilcrow">¶</a>
</div>
</div>
</section>
</div>
</section>
</div>
<div id="pcp">
<section id="section-6.2">
        <h3 id="name-the-password-confirmation-s">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-the-password-confirmation-s" class="section-name selfRef">The Password Confirmation Stage</a>
        </h3>
<p id="section-6.2-1">In the password confirmation (PC) stage, the client proves knowledge
of its password without revealing it. It uses the registered verifiers from the
previous subsection. To do so securely, it uses the key established by CPaceOQUAKE,
which allows it to realize a confidential but unauthenticated channel.
In other words, this password confirmation stage cannot be used by itself.
This PC stage is parameterized by a KEM, KDF, KSF, and is additionally bound
to the preceding protocol via an agreed-upon transcript (tx); see <a href="#configurations" class="auto internal xref">Section 7</a>
for specific parameter configurations.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2-2">The password confirmation is a two-round challenge-response flow between the
server and client. In particular, the server challenges the client to prove
knowledge of its password. More precisely, it challenges the client to prove
knowledge of a seed, derived from the the GenVerifierMaterial function (and
in turn derived from the password using a key stretching function).
Both client and server share a symmetric key as input. Additionally, the server
has the client's public key and salt stored from the previous registration flow.<a href="#section-6.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2-3">A high level overview of this flow is below.<a href="#section-6.2-3" class="pilcrow">¶</a></p>
<div id="section-6.2-4">
          <div class="alignLeft art-svg artwork" id="section-6.2-4.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="288" width="584" viewBox="0 0 584 288" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 104,80 L 104,128" fill="none" stroke="black"></path>
              <path d="M 104,160 L 104,208" fill="none" stroke="black"></path>
              <path d="M 328,80 L 328,128" fill="none" stroke="black"></path>
              <path d="M 328,160 L 328,208" fill="none" stroke="black"></path>
              <path d="M 64,48 L 368,48" fill="none" stroke="black"></path>
              <path d="M 112,112 L 320,112" fill="none" stroke="black"></path>
              <path d="M 112,192 L 320,192" fill="none" stroke="black"></path>
              <path d="M 64,256 L 368,256" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="328,192 316,186.4 316,197.6" fill="black" transform="rotate(0,320,192)"></polygon>
              <polygon class="arrowhead" points="120,112 108,106.4 108,117.6" fill="black" transform="rotate(180,112,112)"></polygon>
              <g class="text">
                <text x="32" y="36">Client:</text>
                <text x="80" y="36">SK,</text>
                <text x="120" y="36">seed,</text>
                <text x="160" y="36">tx,</text>
                <text x="196" y="36">sid,</text>
                <text x="228" y="36">U,</text>
                <text x="248" y="36">S</text>
                <text x="328" y="36">Server:</text>
                <text x="376" y="36">SK,</text>
                <text x="416" y="36">salt,</text>
                <text x="456" y="36">pk,</text>
                <text x="488" y="36">tx,</text>
                <text x="524" y="36">sid,</text>
                <text x="556" y="36">U,</text>
                <text x="576" y="36">S</text>
                <text x="100" y="68">ctx,</text>
                <text x="160" y="68">challenge</text>
                <text x="208" y="68">=</text>
                <text x="284" y="68">PC-Challenge(SK,</text>
                <text x="368" y="68">tx,</text>
                <text x="400" y="68">pk,</text>
                <text x="436" y="68">sid,</text>
                <text x="468" y="68">U,</text>
                <text x="492" y="68">S)</text>
                <text x="216" y="100">challenge</text>
                <text x="48" y="148">client_key,</text>
                <text x="132" y="148">response</text>
                <text x="176" y="148">=</text>
                <text x="248" y="148">PC-Response(SK,</text>
                <text x="336" y="148">seed,</text>
                <text x="376" y="148">tx,</text>
                <text x="436" y="148">challenge,</text>
                <text x="500" y="148">sid,</text>
                <text x="532" y="148">U,</text>
                <text x="556" y="148">S)</text>
                <text x="212" y="180">response</text>
                <text x="172" y="228">server_key</text>
                <text x="224" y="228">=</text>
                <text x="292" y="228">PC-Verify(ctx,</text>
                <text x="392" y="228">response)</text>
                <text x="104" y="244">|</text>
                <text x="328" y="244">|</text>
                <text x="44" y="276">output</text>
                <text x="116" y="276">client_key</text>
                <text x="276" y="276">output</text>
                <text x="348" y="276">server_key</text>
              </g>
            </svg><a href="#section-6.2-4.1" class="pilcrow">¶</a>
</div>
</div>
<div id="server-challenge">
<section id="section-6.2.1">
          <h4 id="name-server-challenge">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-server-challenge" class="section-name selfRef">Server Challenge</a>
          </h4>
<p id="section-6.2.1-1">To construct the challenge, the server encapsulates to the client's public
key. From the resulting shared secret, it then derives password confirmation
values and a new shared secret. The challenge message is the ciphertext encrypted
using a one-time pad derived from the shared secret. The password confirmation
values are byte strings of length <code>Nkc</code>.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">The implementation <span class="bcp14">MUST NOT</span> reveal server_key from the context.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.1-3">
<pre>
PC-Challenge

Input:
- SK, 32-byte symmetric key, a byte string
- transcript, the transcript from previously executed protocols to which this protocol is bound, a byte string
- pk, client-registered public key, a KEM public key
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- context, opaque state for the server to store values to complete the protocol
- challenge, an encoded protocol message for the server to send to the client

Parameters:
- KEM, a KEM instance
- KDF, a KDF instance
- DST, domain separation tag, a byte string

def PC-Challenge(SK, transcript, pk, sid, U, S):
  (c, k) = KEM.Encaps(pk)
  r = KDF.Expand(SK, DST || "OTP", Nct)
  enc_c = XOR(c, r)

  confirm_input = encode_sid(sid, U, S) || SK || enc_c || transcript

  prk_k_h1 = KDF.Extract(confirm_input, DST || "h1")
  prk_k_h2 = KDF.Extract(confirm_input || k, DST || "h2")

  // Derive h1 from the full transcript excluding k
  client_confirm = KDF.Expand(prk_k_h1, DST || "client_confirm", Nkc)

  // Derive h2 || SK from the full transcript including k
  server_confirm = KDF.Expand(prk_k_h2, DST || "server_confirm", Nkc)
  server_key = KDF.Expand(prk_k_h2, DST || "key", Nkey)

  challenge = (enc_c, client_confirm)

  return Context(server_confirm, server_key), challenge
</pre><a href="#section-6.2.1-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="client-response">
<section id="section-6.2.2">
          <h4 id="name-client-response">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-client-response" class="section-name selfRef">Client Response</a>
          </h4>
<p id="section-6.2.2-1">Upon receipt of the challenge, the client decrypts the value and recovers
the salt, KEM ciphertext, and password confirmation value. It then uses the
seed to re-derive the KEM key pair, using the same procedure followed during
the registration flow. The client then decapsulates the ciphertext to recover
the shared secret and derive the same password confirmation values and new
shared secret as the server.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-2">The client then checks that the server-provided confirmation value matches its
own and aborts if not. Otherwise, it returns its own password confirmation value.
The client outputs the new shared secret as its output.<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.2-3">
<pre>
PC-Response

Input:
- SK, 32-byte symmetric key, a byte string
- seed, seed used to derive KEM public key
- transcript, the transcript from previously executed protocols to which this protocol is bound, a byte string
- challenge, an encoded protocol message for the server to send to the client
- sid, session identifier, a byte string
- U and S, client and server identifiers

Output:
- client_key, a 32-byte string
- response, an encoded protocol message for the client to send to the server

Exceptions:
- AuthenticationError, raised when the password confirmation values do not match

Parameters:
- KEM, a KEM instance
- KDF, a KDF instance
- DST, domain separation tag, a byte string

def PC-Response(SK, seed, transcript, challenge, sid, U, S):
  (enc_c, client_confirm_target) = challenge
  r = KDF.Expand(SK, DST || "OTP", Nct)
  c = XOR(enc_c, r)

  (pk, sk) = KEM.DeriveKeyPair(seed)

  try:
    k = KEM.Decaps(sk, c)

    confirm_input = encode_sid(sid, U, S) || SK || enc_c || transcript

    prk_k_h1 = KDF.Extract(confirm_input, DST || "h1")
    prk_k_h2 = KDF.Extract(confirm_input || k, DST || "h2")

    // Derive h1 from the full transcript excluding k
    client_confirm = KDF.Expand(prk_k_h1, DST || "client_confirm", Nkc)

    // Derive h2 || SK from the full transcript including k
    server_confirm = KDF.Expand(prk_k_h2, DST || "server_confirm", Nkc)
    client_key = KDF.Expand(prk_k_h2, DST || "key", Nkey)

    if client_confirm != client_confirm_target:
      raise AuthenticationError

    return client_key, server_confirm
  catch DecapsError:
    raise AuthenticationError
</pre><a href="#section-6.2.2-3" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="server-verify">
<section id="section-6.2.3">
          <h4 id="name-server-verify">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-server-verify" class="section-name selfRef">Server Verify</a>
          </h4>
<p id="section-6.2.3-1">Upon receipt of the response, the server validates that the password confirmation value matches its own value. If the value does not match, the
server aborts. Otherwise, the server outputs the new shared secret as its output.<a href="#section-6.2.3-1" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-6.2.3-2">
<pre>
PC-Verify

Input:
- context, opaque context produced by Challenge
- server_confirm_target, client's response message, a byte string

Output:
- server_key, a 32-byte string

Exceptions:
- AuthenticationError, raised when the password confirmation values do not match

Parameters:

def PC-Verify(context, server_confirm_target):
  (server_confirm, server_key) = context
  if server_confirm != server_confirm_target:
    raise AuthenticationError
  return server_key
</pre><a href="#section-6.2.3-2" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="composition-of-cpaceoquake-password-confirmation">
<section id="section-6.3">
        <h3 id="name-composition-of-cpaceoquake-">
<a href="#section-6.3" class="section-number selfRef">6.3. </a><a href="#name-composition-of-cpaceoquake-" class="section-name selfRef">Composition of CPaceOQUAKE &amp; Password Confirmation</a>
        </h3>
<p id="section-6.3-1">The composition of CPaceOQUAKE and the password confirmation stage is
strictly sequential. First, the parties run CPaceOQUAKE using the verifier.
The client recovers this verifier using the <code>GenVerifierMaterial</code> function.
After that, the parties proceed with password confirmation, which is
initiated by the server using the stored public key. The client uses the
seed that was also produced by <code>GenVerifierMaterial</code> to prove knowledge of
the password. This seed <span class="bcp14">MUST</span> remain secret to prevent impersonation. An
overview of the composition is below.<a href="#section-6.3-1" class="pilcrow">¶</a></p>
<div id="section-6.3-2">
          <div class="alignLeft art-svg artwork" id="section-6.3-2.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="400" width="584" viewBox="0 0 584 400" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 96,32 L 96,88" fill="none" stroke="black"></path>
              <path d="M 96,104 L 96,344" fill="none" stroke="black"></path>
              <path d="M 96,360 L 96,384" fill="none" stroke="black"></path>
              <path d="M 168,112 L 168,320" fill="none" stroke="black"></path>
              <path d="M 200,112 L 200,144" fill="none" stroke="black"></path>
              <path d="M 296,208 L 296,240" fill="none" stroke="black"></path>
              <path d="M 296,272 L 296,304" fill="none" stroke="black"></path>
              <path d="M 312,64 L 312,240" fill="none" stroke="black"></path>
              <path d="M 312,272 L 312,288" fill="none" stroke="black"></path>
              <path d="M 312,336 L 312,352" fill="none" stroke="black"></path>
              <path d="M 328,96 L 328,144" fill="none" stroke="black"></path>
              <path d="M 328,176 L 328,224" fill="none" stroke="black"></path>
              <path d="M 416,96 L 416,144" fill="none" stroke="black"></path>
              <path d="M 416,176 L 416,224" fill="none" stroke="black"></path>
              <path d="M 432,64 L 432,240" fill="none" stroke="black"></path>
              <path d="M 432,272 L 432,288" fill="none" stroke="black"></path>
              <path d="M 432,336 L 432,352" fill="none" stroke="black"></path>
              <path d="M 448,208 L 448,240" fill="none" stroke="black"></path>
              <path d="M 448,272 L 448,304" fill="none" stroke="black"></path>
              <path d="M 472,32 L 472,136" fill="none" stroke="black"></path>
              <path d="M 472,152 L 472,312" fill="none" stroke="black"></path>
              <path d="M 472,328 L 472,344" fill="none" stroke="black"></path>
              <path d="M 472,360 L 472,384" fill="none" stroke="black"></path>
              <path d="M 96,32 L 472,32" fill="none" stroke="black"></path>
              <path d="M 312,64 L 432,64" fill="none" stroke="black"></path>
              <path d="M 136,80 L 280,80" fill="none" stroke="black"></path>
              <path d="M 80,96 L 112,96" fill="none" stroke="black"></path>
              <path d="M 328,96 L 416,96" fill="none" stroke="black"></path>
              <path d="M 136,112 L 280,112" fill="none" stroke="black"></path>
              <path d="M 200,144 L 216,144" fill="none" stroke="black"></path>
              <path d="M 288,144 L 304,144" fill="none" stroke="black"></path>
              <path d="M 328,144 L 416,144" fill="none" stroke="black"></path>
              <path d="M 440,144 L 488,144" fill="none" stroke="black"></path>
              <path d="M 328,176 L 416,176" fill="none" stroke="black"></path>
              <path d="M 296,208 L 312,208" fill="none" stroke="black"></path>
              <path d="M 432,208 L 448,208" fill="none" stroke="black"></path>
              <path d="M 328,224 L 416,224" fill="none" stroke="black"></path>
              <path d="M 312,240 L 432,240" fill="none" stroke="black"></path>
              <path d="M 328,256 L 416,256" fill="none" stroke="black"></path>
              <path d="M 296,304 L 312,304" fill="none" stroke="black"></path>
              <path d="M 432,304 L 448,304" fill="none" stroke="black"></path>
              <path d="M 168,320 L 216,320" fill="none" stroke="black"></path>
              <path d="M 256,320 L 312,320" fill="none" stroke="black"></path>
              <path d="M 432,320 L 488,320" fill="none" stroke="black"></path>
              <path d="M 72,352 L 312,352" fill="none" stroke="black"></path>
              <path d="M 432,352 L 496,352" fill="none" stroke="black"></path>
              <path d="M 328,368 L 416,368" fill="none" stroke="black"></path>
              <path d="M 96,384 L 472,384" fill="none" stroke="black"></path>
              <path d="M 136,80 C 127.16936,80 120,87.16936 120,96" fill="none" stroke="black"></path>
              <path d="M 280,80 C 288.83064,80 296,87.16936 296,96" fill="none" stroke="black"></path>
              <path d="M 136,112 C 127.16936,112 120,104.83064 120,96" fill="none" stroke="black"></path>
              <path d="M 280,112 C 288.83064,112 296,104.83064 296,96" fill="none" stroke="black"></path>
              <path d="M 328,256 C 319.16936,256 312,263.16936 312,272" fill="none" stroke="black"></path>
              <path d="M 416,256 C 424.83064,256 432,263.16936 432,272" fill="none" stroke="black"></path>
              <path d="M 328,368 C 319.16936,368 312,360.83064 312,352" fill="none" stroke="black"></path>
              <path d="M 416,368 C 424.83064,368 432,360.83064 432,352" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="504,352 492,346.4 492,357.6" fill="black" transform="rotate(0,496,352)"></polygon>
              <path class="jump" d="M 472,360 C 466,360 466,344 472,344" fill="none" stroke="black"></path>
              <path class="jump" d="M 472,328 C 466,328 466,312 472,312" fill="none" stroke="black"></path>
              <path class="jump" d="M 472,152 C 466,152 466,136 472,136" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="448,144 436,138.4 436,149.6" fill="black" transform="rotate(180,440,144)"></polygon>
              <polygon class="arrowhead" points="440,320 428,314.4 428,325.6" fill="black" transform="rotate(180,432,320)"></polygon>
              <polygon class="arrowhead" points="440,304 428,298.4 428,309.6" fill="black" transform="rotate(180,432,304)"></polygon>
              <polygon class="arrowhead" points="320,320 308,314.4 308,325.6" fill="black" transform="rotate(0,312,320)"></polygon>
              <polygon class="arrowhead" points="320,304 308,298.4 308,309.6" fill="black" transform="rotate(0,312,304)"></polygon>
              <polygon class="arrowhead" points="312,144 300,138.4 300,149.6" fill="black" transform="rotate(0,304,144)"></polygon>
              <polygon class="arrowhead" points="120,96 108,90.4 108,101.6" fill="black" transform="rotate(0,112,96)"></polygon>
              <path class="jump" d="M 96,360 C 102,360 102,344 96,344" fill="none" stroke="black"></path>
              <path class="jump" d="M 96,104 C 102,104 102,88 96,88" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="80,352 68,346.4 68,357.6" fill="black" transform="rotate(180,72,352)"></polygon>
              <g class="text">
                <text x="156" y="52">CPaceOQUAKE+</text>
                <text x="36" y="84">Client's</text>
                <text x="368" y="84">CPaceOQUAKE</text>
                <text x="36" y="100">password</text>
                <text x="208" y="100">GenVerifierMaterial</text>
                <text x="368" y="116">CPace</text>
                <text x="372" y="132">protocol</text>
                <text x="252" y="148">Verifier</text>
                <text x="532" y="148">Verifier</text>
                <text x="372" y="196">OQUAKE</text>
                <text x="372" y="212">protocol</text>
                <text x="292" y="260">SK</text>
                <text x="452" y="260">SK</text>
                <text x="372" y="308">Password</text>
                <text x="236" y="324">seed</text>
                <text x="372" y="324">confirmation</text>
                <text x="524" y="324">Public</text>
                <text x="568" y="324">key</text>
                <text x="32" y="356">Session</text>
                <text x="536" y="356">Session</text>
                <text x="32" y="372">key</text>
                <text x="536" y="372">key</text>
              </g>
            </svg><a href="#section-6.3-2.1" class="pilcrow">¶</a>
</div>
</div>
<p id="section-6.3-3">Upon successful completion of the entire protocol, the client and server will share a
symmetric key that was authenticated by knowledge of the password. The protocol
aborts if the password did not match. The protocol flows are shown below.
Note here that if the client does not know the salt, the server must send
it, which it can do in plain text.<a href="#section-6.3-3" class="pilcrow">¶</a></p>
<div id="section-6.3-4">
          <div class="alignLeft art-svg artwork" id="section-6.3-4.1">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="608" width="568" viewBox="0 0 568 608" class="diagram" text-anchor="middle" font-family="monospace" font-size="13px" stroke-linecap="round">
              <path d="M 104,96 L 104,224" fill="none" stroke="black"></path>
              <path d="M 104,272 L 104,432" fill="none" stroke="black"></path>
              <path d="M 104,480 L 104,568" fill="none" stroke="black"></path>
              <path d="M 384,96 L 384,224" fill="none" stroke="black"></path>
              <path d="M 384,256 L 384,320" fill="none" stroke="black"></path>
              <path d="M 384,384 L 384,448" fill="none" stroke="black"></path>
              <path d="M 384,480 L 384,536" fill="none" stroke="black"></path>
              <path d="M 88,48 L 400,48" fill="none" stroke="black"></path>
              <path d="M 112,128 L 376,128" fill="none" stroke="black"></path>
              <path d="M 112,208 L 376,208" fill="none" stroke="black"></path>
              <path d="M 112,304 L 376,304" fill="none" stroke="black"></path>
              <path d="M 112,416 L 376,416" fill="none" stroke="black"></path>
              <path d="M 112,512 L 376,512" fill="none" stroke="black"></path>
              <path d="M 88,576 L 400,576" fill="none" stroke="black"></path>
              <polygon class="arrowhead" points="392,168 380,162.4 380,173.6" fill="black" transform="rotate(90,384,168)"></polygon>
              <polygon class="arrowhead" points="384,512 372,506.4 372,517.6" fill="black" transform="rotate(0,376,512)"></polygon>
              <polygon class="arrowhead" points="384,304 372,298.4 372,309.6" fill="black" transform="rotate(0,376,304)"></polygon>
              <polygon class="arrowhead" points="384,128 372,122.4 372,133.6" fill="black" transform="rotate(0,376,128)"></polygon>
              <polygon class="arrowhead" points="120,416 108,410.4 108,421.6" fill="black" transform="rotate(180,112,416)"></polygon>
              <polygon class="arrowhead" points="120,208 108,202.4 108,213.6" fill="black" transform="rotate(180,112,208)"></polygon>
              <g class="text">
                <text x="32" y="36">Client:</text>
                <text x="132" y="36">PRS,salt,U,S,sid</text>
                <text x="272" y="36">Server:</text>
                <text x="356" y="36">v,pk,U,S,sid</text>
                <text x="16" y="68">(v,</text>
                <text x="56" y="68">seed)</text>
                <text x="88" y="68">=</text>
                <text x="196" y="68">GenVerifierMaterial(PRS,</text>
                <text x="320" y="68">salt)</text>
                <text x="384" y="68">|</text>
                <text x="24" y="84">ctx1,</text>
                <text x="68" y="84">msg1</text>
                <text x="96" y="84">=</text>
                <text x="216" y="84">CPaceOQUAKE.Init(v,sid,U,S)</text>
                <text x="392" y="84">|</text>
                <text x="244" y="116">msg1</text>
                <text x="136" y="164">ctx2,</text>
                <text x="180" y="164">msg2</text>
                <text x="208" y="164">=</text>
                <text x="300" y="164">CPaceOQUAKE.Respond(</text>
                <text x="444" y="164">,msg1,sid,U,S)</text>
                <text x="244" y="196">msg2</text>
                <text x="16" y="244">SK,</text>
                <text x="52" y="244">msg3</text>
                <text x="80" y="244">=</text>
                <text x="204" y="244">CPaceOQUAKE.InitiatorFinish(</text>
                <text x="392" y="244">|</text>
                <text x="112" y="260">v,ctx1,msg2,32,sid,U,S)</text>
                <text x="244" y="292">msg3</text>
                <text x="228" y="340">SK</text>
                <text x="248" y="340">=</text>
                <text x="412" y="340">CPaceOQUAKE.ResponderFinish(ctx2,msg3)</text>
                <text x="228" y="356">tx</text>
                <text x="248" y="356">=</text>
                <text x="276" y="356">msg1</text>
                <text x="308" y="356">||</text>
                <text x="340" y="356">msg2</text>
                <text x="372" y="356">||</text>
                <text x="404" y="356">msg3</text>
                <text x="232" y="372">ctx3,</text>
                <text x="276" y="372">chal</text>
                <text x="304" y="372">=</text>
                <text x="436" y="372">PC-Challenge(SK,tx,pk,sid,U,S)</text>
                <text x="244" y="404">chal</text>
                <text x="60" y="452">tx</text>
                <text x="80" y="452">=</text>
                <text x="108" y="452">msg1</text>
                <text x="140" y="452">||</text>
                <text x="172" y="452">msg2</text>
                <text x="204" y="452">||</text>
                <text x="236" y="452">msg3</text>
                <text x="48" y="468">client_key,</text>
                <text x="116" y="468">resp</text>
                <text x="144" y="468">=</text>
                <text x="300" y="468">PC-Response(SK,seed,tx,chal,sid,U,S)</text>
                <text x="244" y="500">resp</text>
                <text x="300" y="548">server_key</text>
                <text x="352" y="548">=</text>
                <text x="424" y="548">PC-Verify(ctx2,</text>
                <text x="512" y="548">resp)</text>
                <text x="384" y="564">|</text>
                <text x="76" y="596">output</text>
                <text x="148" y="596">client_key</text>
                <text x="348" y="596">output</text>
                <text x="420" y="596">server_key</text>
              </g>
            </svg><a href="#section-6.3-4.1" class="pilcrow">¶</a>
</div>
</div>
</section>
</div>
</section>
</div>
<div id="configurations">
<section id="section-7">
      <h2 id="name-cpaceoquake-configurations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-cpaceoquake-configurations" class="section-name selfRef">CPaceOQUAKE+ Configurations</a>
      </h2>
<p id="section-7-1">CPaceOQUAKE+ is instantiated by selecting a configuration of a group and hash function
for the CPace protocol, a KEM, KDF, KSF, for password confirmation, and a KEM and KDF for CPaceOQUAKE, and a general
purpose cryptographic hash function H.
The KEM, KDF, are not required to be the same, so they are distinguished by "PC-" and "PAKE-" prefixes, e.g., PC-KDF and
PAKE-KDF are the KDFs for the password confirmation stage and the CPaceOQUAKE protocol, respectively.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">The <span class="bcp14">RECOMMENDED</span> configuration is below.<a href="#section-7-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-3.1">
          <p id="section-7-3.1.1">CPace-Group: ristretto255-SHA512<a href="#section-7-3.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.2">
          <p id="section-7-3.2.1">CPace-Hash: SHA-512<a href="#section-7-3.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.3">
          <p id="section-7-3.3.1">KEM: X-Wing <span>[<a href="#XWING" class="cite xref">XWING</a>]</span><a href="#section-7-3.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.4">
          <p id="section-7-3.4.1">PC-KDF: HKDF-SHA-256<a href="#section-7-3.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.5">
          <p id="section-7-3.5.1">PC-KSF: Argon2id(S = zeroes(16), p = 4, T = Nh, m = 2^21, t = 1, v = 0x13, K = nil, X = nil, y = 2) <span>[<a href="#ARGON2" class="cite xref">ARGON2</a>]</span><a href="#section-7-3.5.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.6">
          <p id="section-7-3.6.1">BUKEM: ML-BUKEM768 <a href="#deps-kem" class="auto internal xref">Section 4.1</a><a href="#section-7-3.6.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.7">
          <p id="section-7-3.7.1">PAKE-KDF: HKDF-SHA-256<a href="#section-7-3.7.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.8">
          <p id="section-7-3.8.1">H: SHA256<a href="#section-7-3.8.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-3.9">
          <p id="section-7-3.9.1">DST: "1b3abc3cd05e8054e8399bc38dfcbc1321d2e1b02da335ed1e8031ef5199f672" (a randomly generated 32-byte string)<a href="#section-7-3.9.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-4">The <span class="bcp14">RECOMMENDED</span> parameters are (see <a href="#params" class="auto internal xref">Appendix A</a>):<a href="#section-7-4" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-7-5.1">
          <p id="section-7-5.1.1">Nseed = 32<a href="#section-7-5.1.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-5.2">
          <p id="section-7-5.2.1">Nverifier = 32<a href="#section-7-5.2.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-5.3">
          <p id="section-7-5.3.1">Nkc = 64<a href="#section-7-5.3.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-5.4">
          <p id="section-7-5.4.1">Nsec = 32<a href="#section-7-5.4.1" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-7-5.5">
          <p id="section-7-5.5.1">Nkey = 32, this is achieved by choosing H in CPace with H.b_in_bytes = 32<a href="#section-7-5.5.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-7-6">Other documents can define configurations as needed for their use case, subject to the following requirements:<a href="#section-7-6" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-7-7">
<li id="section-7-7.1">
          <p id="section-7-7.1.1">KEM <span class="bcp14">MUST</span> be a hybrid KEM, i.e., one that achieves both classical and post-quantum security.<a href="#section-7-7.1.1" class="pilcrow">¶</a></p>
</li>
        <li id="section-7-7.2">
          <p id="section-7-7.2.1">The parameters must be chosen so they correspond with this KEM. E.g., Nseed must have the correct length.<a href="#section-7-7.2.1" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="implementation-considerations">
<section id="section-8">
      <h2 id="name-implementation-consideratio">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
      </h2>
<p id="section-8-1">Some functions included in this specification are fallible (as noted by their ability
to raise exceptions). The explicit errors generated
throughout this specification, along with conditions that lead to each error,
are as follows:<a href="#section-8-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-2.1">
          <p id="section-8-2.1.1">AuthenticationError: The PC protocol fails password confirmation checks at the
client or server; <a href="#pcp" class="auto internal xref">Section 6.2</a><a href="#section-8-2.1.1" class="pilcrow">¶</a></p>
</li>
      </ul>
<p id="section-8-3">Beyond these explicit errors, CPaceOQUAKE+ implementations can produce implicit errors.
For example, if protocol messages sent between client and server do not match
their expected size, an implementation should produce an error.<a href="#section-8-3" class="pilcrow">¶</a></p>
<p id="section-8-4">The errors in this document are meant as a guide for implementors. They are not an
exhaustive list of all the errors an implementation might emit. For example, an
implementation might run out of memory.<a href="#section-8-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-9">
      <h2 id="name-security-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-9-1">TODO: draft once the proofs are complete<a href="#section-9-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana-considerations">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-10-1">This document has no IANA actions.<a href="#section-10-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="sec-combined-references">
<section id="section-11">
      <h2 id="name-references">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<div id="sec-normative-references">
<section id="section-11.1">
        <h3 id="name-normative-references">
<a href="#section-11.1" class="section-number selfRef">11.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="ARGON2">[ARGON2]</dt>
        <dd>
<span class="refAuthor">Biryukov, A.</span>, <span class="refAuthor">Dinu, D.</span>, <span class="refAuthor">Khovratovich, D.</span>, and <span class="refAuthor">S. Josefsson</span>, <span class="refTitle">"Argon2 Memory-Hard Function for Password Hashing and Proof-of-Work Applications"</span>, <span class="seriesInfo">RFC 9106</span>, <span class="seriesInfo">DOI 10.17487/RFC9106</span>, <time datetime="2021-09" class="refDate">September 2021</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc9106">https://www.rfc-editor.org/rfc/rfc9106</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CPACE">[CPACE]</dt>
        <dd>
<span class="refAuthor">Abdalla, M.</span>, <span class="refAuthor">Haase, B.</span>, and <span class="refAuthor">J. Hesse</span>, <span class="refTitle">"CPace, a balanced composable PAKE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-cpace-13</span>, <time datetime="2024-10-14" class="refDate">14 October 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-cpace-13">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-cpace-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="CPace">[CPace]</dt>
        <dd>
<span class="refAuthor">Abdalla, M.</span>, <span class="refAuthor">Haase, B.</span>, and <span class="refAuthor">J. Hesse</span>, <span class="refTitle">"CPace, a balanced composable PAKE"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-cpace-13</span>, <time datetime="2024-10-14" class="refDate">14 October 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-cpace-13">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-cpace-13</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FIPS202">[FIPS202]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"SHA-3 Standard: Permutation-Based Hash and Extendable-Output Functions"</span>, <time datetime="2015-08" class="refDate">August 2015</time>, <span>&lt;<a href="https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf">https://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.202.pdf</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="FIPS203">[FIPS203]</dt>
        <dd>
<span class="refAuthor">National Institute of Standards and Technology (NIST)</span>, <span class="refTitle">"Module-Lattice-Based Key-Encapsulation Mechanism Standard"</span>, <time datetime="2024-08" class="refDate">August 2024</time>, <span>&lt;<a href="https://csrc.nist.gov/pubs/fips/203/final">https://csrc.nist.gov/pubs/fips/203/final</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="KEMELEON">[KEMELEON]</dt>
        <dd>
<span class="refAuthor">Günther, F.</span>, <span class="refAuthor">Stebila, D.</span>, and <span class="refAuthor">S. Veitch</span>, <span class="refTitle">"Kemeleon Encodings"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-veitch-kemeleon-00</span>, <time datetime="2024-11-29" class="refDate">29 November 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-veitch-kemeleon-00">https://datatracker.ietf.org/doc/html/draft-veitch-kemeleon-00</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="OQUAKE">[OQUAKE]</dt>
        <dd>
<span class="refAuthor">Beguinet, H.</span>, <span class="refAuthor">Chevalier, C.</span>, <span class="refAuthor">Pointcheval, D.</span>, <span class="refAuthor">Ricosset, T.</span>, and <span class="refAuthor">M. Rossi</span>, <span class="refTitle">"GeT a CAKE: Generic Transformations from Key Encaspulation Mechanisms to Password Authenticated Key Exchanges"</span>, <span class="refContent">Springer Nature Switzerland</span>, <span class="seriesInfo">Lecture Notes in Computer Science pp. 516-538</span>, <span class="seriesInfo">DOI 10.1007/978-3-031-33491-7_19</span>, <span class="seriesInfo">ISBN ["9783031334900", "9783031334917"]</span>, <time datetime="2023" class="refDate">2023</time>, <span>&lt;<a href="https://doi.org/10.1007/978-3-031-33491-7_19">https://doi.org/10.1007/978-3-031-33491-7_19</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc2119">https://www.rfc-editor.org/rfc/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8017">[RFC8017]</dt>
        <dd>
<span class="refAuthor">Moriarty, K., Ed.</span>, <span class="refAuthor">Kaliski, B.</span>, <span class="refAuthor">Jonsson, J.</span>, and <span class="refAuthor">A. Rusch</span>, <span class="refTitle">"PKCS #1: RSA Cryptography Specifications Version 2.2"</span>, <span class="seriesInfo">RFC 8017</span>, <span class="seriesInfo">DOI 10.17487/RFC8017</span>, <time datetime="2016-11" class="refDate">November 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8017">https://www.rfc-editor.org/rfc/rfc8017</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
        <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/rfc/rfc8174">https://www.rfc-editor.org/rfc/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="XWING">[XWING]</dt>
      <dd>
<span class="refAuthor">Connolly, D.</span>, <span class="refAuthor">Schwabe, P.</span>, and <span class="refAuthor">B. Westerbaan</span>, <span class="refTitle">"X-Wing: general-purpose hybrid post-quantum KEM"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-connolly-cfrg-xwing-kem-06</span>, <time datetime="2024-10-21" class="refDate">21 October 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-connolly-cfrg-xwing-kem-06">https://datatracker.ietf.org/doc/html/draft-connolly-cfrg-xwing-kem-06</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
<div id="sec-informative-references">
<section id="section-11.2">
        <h3 id="name-informative-references">
<a href="#section-11.2" class="section-number selfRef">11.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="OPAQUE">[OPAQUE]</dt>
        <dd>
<span class="refAuthor">Bourdrez, D.</span>, <span class="refAuthor">Krawczyk, H.</span>, <span class="refAuthor">Lewi, K.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"The OPAQUE Augmented PAKE Protocol"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-opaque-18</span>, <time datetime="2024-11-21" class="refDate">21 November 2024</time>, <span>&lt;<a href="https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-opaque-18">https://datatracker.ietf.org/doc/html/draft-irtf-cfrg-opaque-18</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="SPAKE2PLUS">[SPAKE2PLUS]</dt>
      <dd>
<span class="refTitle">"*** BROKEN REFERENCE ***"</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="params">
<section id="appendix-A">
      <h2 id="name-deriving-parameters">
<a href="#appendix-A" class="section-number selfRef">Appendix A. </a><a href="#name-deriving-parameters" class="section-name selfRef">Deriving parameters</a>
      </h2>
<p id="appendix-A-1">This section discusses how to generate parameters, given an upper bound on an adversary's advantage in breaking the hybrid (a)PAKE. The parameters in this standard correspond to a classical hardness of 117 bits (considering the attacker can break CPace) and a quantum hardness of 100 bits. We assume that an adversary can perform at most 2^qq queries to random oracles or (a)PAKE sessions. We use qq = 64. The derivation below uses some approximations, ignoring small constants in the exponent such as 1 and 1.6. We also only study dominant terms in the advantage equations.<a href="#appendix-A-1" class="pilcrow">¶</a></p>
<div id="parameters-for-cpaceoquake">
<section id="appendix-A.1">
        <h3 id="name-parameters-for-cpaceoquake">
<a href="#appendix-A.1" class="section-number selfRef">A.1. </a><a href="#name-parameters-for-cpaceoquake" class="section-name selfRef">Parameters for CPaceOQUAKE+</a>
        </h3>
<p id="appendix-A.1-1">We have the following requirements:<a href="#appendix-A.1-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.1-2.1">
            <p id="appendix-A.1-2.1.1">Nseed * 8 + Nverifier * 8 &gt;= 2 * qq + classical hardness<a href="#appendix-A.1-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.2">
            <p id="appendix-A.1-2.2.1">Nverifier * 8 &gt;= qq + classical hardness<a href="#appendix-A.1-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.3">
            <p id="appendix-A.1-2.3.1">Nkc * 8 &gt;= qq + classical hardness<a href="#appendix-A.1-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.4">
            <p id="appendix-A.1-2.4.1">KEM failure &lt;= -qq - classical hardness<a href="#appendix-A.1-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.5">
            <p id="appendix-A.1-2.5.1">KEM ind vs classical &lt;= -qq - classical hardness<a href="#appendix-A.1-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.6">
            <p id="appendix-A.1-2.6.1">KEM ind vs quantum &lt;= -qq - quantum hardness<a href="#appendix-A.1-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.7">
            <p id="appendix-A.1-2.7.1">CPaceOQUAKE vs classical &lt;= classical hardness<a href="#appendix-A.1-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.1-2.8">
            <p id="appendix-A.1-2.8.1">CPaceOQUAKE vs quantum &lt;= quantum hardness<a href="#appendix-A.1-2.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.1-3">For ML-KEM we have Nseed = 32.
For consistency, the spec uses Nverifier = 32.
ML-KEM768's failure probability is 2^-165.2 and ML-KEM1024's failure probability is 2^-175.2. Both are slightly too large, but we deem them acceptable: the chance that an adversary encounters a failure is purely statistical and very small.<a href="#appendix-A.1-3" class="pilcrow">¶</a></p>
<p id="appendix-A.1-4">The following subsection discusses the parameters and hardness of CPaceOQUAKE.<a href="#appendix-A.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="parameters-for-cpaceoquake-1">
<section id="appendix-A.2">
        <h3 id="name-parameters-for-cpaceoquake-2">
<a href="#appendix-A.2" class="section-number selfRef">A.2. </a><a href="#name-parameters-for-cpaceoquake-2" class="section-name selfRef">Parameters for CPaceOQUAKE</a>
        </h3>
<p id="appendix-A.2-1">For the security of CPaceOQUAKE+, we require that CPaceOQUAKE provides:<a href="#appendix-A.2-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-2.1">
            <p id="appendix-A.2-2.1.1">CPaceOQUAKE vs classical &lt;= classical hardness<a href="#appendix-A.2-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-2.2">
            <p id="appendix-A.2-2.2.1">CPaceOQUAKE vs quantum &lt;= quantum hardness<a href="#appendix-A.2-2.2.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.2-3">We have the following requirements when CPaceOQUAKE relies on CPace's security:<a href="#appendix-A.2-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-4.1">
            <p id="appendix-A.2-4.1.1">CPace vs classical &lt;= classical hardness<a href="#appendix-A.2-4.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-4.2">
            <p id="appendix-A.2-4.2.1">Nkey * 8 &gt;= qq + classical hardness<a href="#appendix-A.2-4.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-4.3">
            <p id="appendix-A.2-4.3.1">KEM failure &lt;= -qq - classical hardness<a href="#appendix-A.2-4.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.2-5">We have the following requirements when CPaceOQUAKE relies on OQUAKE's security:<a href="#appendix-A.2-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.2-6.1">
            <p id="appendix-A.2-6.1.1">OQUAKE vs classical &lt;= classical hardness<a href="#appendix-A.2-6.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-6.2">
            <p id="appendix-A.2-6.2.1">OQUAKE vs quantum &lt;= quantum hardness<a href="#appendix-A.2-6.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.2-6.3">
            <p id="appendix-A.2-6.3.1">Nkey * 8 &gt;= 2*qq + classical hardness<a href="#appendix-A.2-6.3.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.2-7">So, the smallest Nkey = 32.
We ignore the KEM failure following the same reasoning as above.<a href="#appendix-A.2-7" class="pilcrow">¶</a></p>
<p id="appendix-A.2-8">The following subsections discuss the parameters and hardness of CPace and OQUAKE.<a href="#appendix-A.2-8" class="pilcrow">¶</a></p>
</section>
</div>
<div id="parameters-for-cpace">
<section id="appendix-A.3">
        <h3 id="name-parameters-for-cpace">
<a href="#appendix-A.3" class="section-number selfRef">A.3. </a><a href="#name-parameters-for-cpace" class="section-name selfRef">Parameters for CPace</a>
        </h3>
<p id="appendix-A.3-1">We refer to the CPace <span>[<a href="#CPace" class="cite xref">CPace</a>]</span>.
This standard requires Nkey, the number of bytes in CPace's session key, to be 32, so one must set H.bmax_in_bytes = 32.<a href="#appendix-A.3-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="parameters-for-oquake">
<section id="appendix-A.4">
        <h3 id="name-parameters-for-oquake">
<a href="#appendix-A.4" class="section-number selfRef">A.4. </a><a href="#name-parameters-for-oquake" class="section-name selfRef">Parameters for OQUAKE</a>
        </h3>
<p id="appendix-A.4-1">We have the following requirements:<a href="#appendix-A.4-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="appendix-A.4-2.1">
            <p id="appendix-A.4-2.1.1">BUKEM ind vs classical &lt;= -qq - classical hardness<a href="#appendix-A.4-2.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.2">
            <p id="appendix-A.4-2.2.1">BUKEM ind vs quantum &lt;= -qq - quantum hardness<a href="#appendix-A.4-2.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.3">
            <p id="appendix-A.4-2.3.1">BUKEM public key uniformity vs classical &lt;= -qq - classical hardness<a href="#appendix-A.4-2.3.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.4">
            <p id="appendix-A.4-2.4.1">BUKEM public key uniformity vs quantum &lt;= -qq - quantum hardness<a href="#appendix-A.4-2.4.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.5">
            <p id="appendix-A.4-2.5.1">BUKEM ciphertext uniformity vs classical &lt;= -qq - classical hardness<a href="#appendix-A.4-2.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.6">
            <p id="appendix-A.4-2.6.1">BUKEM ciphertext uniformity vs quantum &lt;= -qq - quantum hardness<a href="#appendix-A.4-2.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.7">
            <p id="appendix-A.4-2.7.1">BUKEM key * 8 &gt;= qq + classical hardness<a href="#appendix-A.4-2.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="normal" id="appendix-A.4-2.8">
            <p id="appendix-A.4-2.8.1">KEM failure &lt;= -qq - classical hardness<a href="#appendix-A.4-2.8.1" class="pilcrow">¶</a></p>
</li>
        </ul>
<p id="appendix-A.4-3">For, ML-BUKEM it is as hard or harder to break public key and ciphertext uniformity as it is to break indistinguishability, so we discuss all three properties at once.<a href="#appendix-A.4-3" class="pilcrow">¶</a></p>
<p id="appendix-A.4-4">For ML-BUKEM768, the resistance to classical attacks is approximately <code>181 - qq</code> bits of security. So for qq = 64, classical hardness is approximately 117 bits of security. The resistance to quantum attacks is approximately <code>164 - qq</code> bits of security. So for qq = 64, quantum hardness is approximately 100 bits of security.<a href="#appendix-A.4-4" class="pilcrow">¶</a></p>
<p id="appendix-A.4-5">For ML-BUKEM1024, this would come out to <code>253 - 64 = 189</code> bits of security for classical attacks and <code>230 - 64 = 166</code> bits of security for quantum attacks.<a href="#appendix-A.4-5" class="pilcrow">¶</a></p>
<p id="appendix-A.4-6">The ML-BUKEM key is 32 bytes, so this satisfies the requirements.
We ignore the KEM failure following the same reasoning as above.<a href="#appendix-A.4-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="authors-addresses">
<section id="appendix-B">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Jelle Vos</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:jvos@apple.com" class="email">jvos@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Stanislaw Jarecki</span></div>
<div dir="auto" class="left"><span class="org">University of California, Irvine</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:sjarecki@ics.uci.edu" class="email">sjarecki@ics.uci.edu</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Apple, Inc.</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:caw@heapingbits.net" class="email">caw@heapingbits.net</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
